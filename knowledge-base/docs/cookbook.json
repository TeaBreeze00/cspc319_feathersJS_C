[
  {
    "id": "v5-doc-079",
    "title": "Docker Deployment",
    "content": "# Dockerize a Feathers application\n\nA Feathers application can be [dockerized like any other Node.js application](https://nodejs.org/en/docs/guides/nodejs-docker-webapp/).\n\n## Create an app\n\n```sh\nmkdir feathers-app\ncd feathers-app/\nfeathers generate app\n```\n\n### Dockerfile\n\nAdd the following `Dockerfile` to the project directory:\n\n```\nFROM node:lts-alpine\n\nWORKDIR /usr/src/app\n\nCOPY package*.json ./\n\nRUN npm install\n\nCOPY . .\n\nEXPOSE 3030\n\nCMD [\"npm\", \"run\", \"start\"]\n```\n\n## Build the image\n\n```sh\ndocker build -t my-feathers-image .\n```\n\n## Start the container\n\n```sh\ndocker run -d -p 3030:3030 --name my-feathers-container my-feathers-image\n```",
    "version": "v5",
    "tokens": [
      "docker",
      "deployment",
      "dockerize",
      "feathers",
      "application",
      "dockerized",
      "like",
      "node",
      "js",
      "https",
      "nodejs",
      "org",
      "en",
      "docs",
      "guides",
      "webapp",
      "create",
      "app",
      "sh",
      "mkdir",
      "cd",
      "generate",
      "dockerfile",
      "add",
      "following",
      "project",
      "directory",
      "lts",
      "alpine",
      "workdir",
      "usr",
      "src",
      "copy",
      "package",
      "json",
      "run",
      "npm",
      "install",
      "expose",
      "3030",
      "cmd",
      "start",
      "build",
      "image",
      "container",
      "name"
    ],
    "category": "cookbook",
    "source": {
      "path": "cookbook/deploy/docker.md"
    },
    "tags": [
      "docker",
      "deployment",
      "container"
    ],
    "embedding": [
      -0.009519,
      0.050219,
      0.077277,
      0.017982,
      0.056466,
      -0.083668,
      0.010215,
      -0.022355,
      -0.00496,
      0.030741,
      -0.036385,
      -0.006367,
      -0.009985,
      0.017551,
      0.006579,
      0.01963,
      -0.01466,
      0.030794,
      0.040287,
      0.049252,
      -0.068045,
      0.035912,
      0.076653,
      0.038235,
      -0.016604,
      0.012942,
      -0.069993,
      -0.010924,
      0.008438,
      -0.014223,
      0.04945,
      -0.011024,
      0.015679,
      -0.057704,
      0.001373,
      0.190682,
      -0.036495,
      -0.064564,
      -0.048307,
      -0.053501,
      0.057813,
      -0.020335,
      -0.067974,
      -0.053104,
      -0.00953,
      -0.093224,
      -0.022376,
      -0.049167,
      -0.00821,
      0.093445,
      -0.057163,
      -0.113428,
      -0.036587,
      -0.040076,
      -0.01545,
      0.096961,
      -0.053305,
      0.049986,
      -0.04716,
      -0.002857,
      0.020777,
      0.003706,
      0.02564,
      -0.006522,
      0.086917,
      0.045283,
      -0.027474,
      -0.005148,
      0.027371,
      -0.053173,
      0.071192,
      -0.008173,
      -0.034407,
      -0.039366,
      -0.108078,
      -0.01245,
      -0.0287,
      0.050785,
      -0.00964,
      0.086201,
      0.002491,
      -0.063961,
      -0.002476,
      0.021268,
      -0.057878,
      0.062997,
      0.041526,
      -0.028956,
      0.017401,
      -0.092492,
      0.002035,
      -0.069553,
      -0.031135,
      0.011428,
      0.070582,
      -0.020524,
      -0.044502,
      0.124978,
      -0.024971,
      0.00151,
      0.022657,
      -0.066426,
      0.024626,
      -0.082112,
      0.117978,
      -0.001526,
      -0.025212,
      -0.064166,
      -0.071543,
      0.03636,
      -0.029304,
      -0.011972,
      -0.010774,
      0.022697,
      0.026992,
      0.010971,
      -0.040538,
      -0.057478,
      0.022384,
      0.11634,
      0.122956,
      -0.019848,
      0.128733,
      -0.006535,
      0.007191,
      -0.002347,
      -0.064714,
      0,
      0.044257,
      -0.073943,
      0.048696,
      0.067871,
      0.123215,
      -0.029228,
      0.034579,
      -0.04569,
      -0.100916,
      0.020673,
      -0.065155,
      0.062372,
      0.005664,
      0.043041,
      0.028923,
      -0.078059,
      -0.015051,
      -0.036696,
      0.068346,
      -0.036783,
      -0.022662,
      -0.037544,
      -0.106781,
      0.019248,
      0.023217,
      -0.025553,
      0.042882,
      -0.09211,
      -0.022223,
      0.001172,
      0.103395,
      -0.030097,
      0.013796,
      0.007571,
      0.01097,
      -0.026828,
      -0.025867,
      0.049522,
      -0.100955,
      0.074325,
      0.06948,
      -0.067508,
      -0.016264,
      0.033104,
      0.017001,
      -0.042533,
      -0.032064,
      0.009826,
      0.070091,
      0.011959,
      0.04754,
      -0.026934,
      0.006507,
      0.029976,
      0.032796,
      -0.021058,
      0.003691,
      -0.108858,
      -0.09405,
      -0.04903,
      -0.072688,
      -0.007385,
      0.015345,
      -0.019687,
      0.060691,
      0.00798,
      -0.019042,
      0.028521,
      -0.077879,
      0.090655,
      0.037717,
      -0.004735,
      0.019411,
      0.008724,
      -0.003248,
      0.0132,
      0.027617,
      0.058922,
      -0.036856,
      -0.026502,
      0.01142,
      0.032906,
      -0.045503,
      0.020514,
      -0.002632,
      -0.038511,
      0.016291,
      0.058665,
      -0.006269,
      0.012469,
      0.080382,
      0.046046,
      -0.058832,
      -0.103745,
      -0.120767,
      0,
      0.034368,
      -0.008731,
      -0.075439,
      0.041601,
      0.019947,
      -0.022723,
      0.081784,
      0.024328,
      0.066113,
      0.02051,
      -0.108281,
      0.075097,
      0.062115,
      0.070347,
      -0.111799,
      0.069787,
      -0.077507,
      -0.013133,
      0.046393,
      -0.062941,
      -0.022829,
      0.01935,
      0.081513,
      0.048207,
      -0.083462,
      -0.003313,
      0.062173,
      -0.073306,
      -0.018413,
      -0.035708,
      -0.041235,
      -0.004796,
      0.004669,
      0.053258,
      -0.044859,
      0.023879,
      -0.024232,
      0.02375,
      -0.041709,
      -0.091776,
      -0.00723,
      -0.088884,
      -0.020251,
      -0.088532,
      -0.02048,
      -0.097009,
      -0.010055,
      -0.007517,
      -0.034043,
      -0.041723,
      -0.003134,
      -0.039143,
      0.067819,
      0.073459,
      0.038673,
      0.013208,
      0.017498,
      0.029299,
      0.003901,
      0.075793,
      0.105462,
      -0.051167,
      0.026407,
      -0.03726,
      -0.039206,
      -0.055989,
      -0.122829,
      -0.026562,
      -0.052567,
      0.007673,
      -0.022687,
      0.033328,
      0.031383,
      0.049859,
      -0.026145,
      0.008791,
      0.020976,
      -0.03343,
      0.070819,
      -0.062984,
      -0.03093,
      0.087997,
      -0.006724,
      -0.033182,
      -0.021023,
      -0.023519,
      0.065723,
      -0.001728,
      0.022023,
      -0.064018,
      0.044462,
      -0.01661,
      -0.026821,
      -0.009526,
      0.024225,
      0,
      0.033547,
      0.051448,
      -0.081049,
      0.010995,
      0.057853,
      0.044869,
      0.05202,
      -0.014647,
      0.004136,
      0.026733,
      -0.071657,
      0.017442,
      -0.059445,
      0.038606,
      0.012785,
      0.003246,
      0.008848,
      0.071651,
      -0.024546,
      -0.093893,
      -0.056191,
      0.058815,
      -0.00261,
      -0.007529,
      0.041821,
      0.014904,
      0.044081,
      0.009709,
      0.028834,
      -0.008102,
      -0.06846,
      -0.009696,
      -0.006009,
      -0.029641,
      -0.027238,
      -0.030874,
      -0.050413,
      0.008252,
      0.057743,
      -0.018405,
      -0.095315,
      -0.004435,
      0.019513,
      -0.049214,
      -0.0253,
      -0.04303,
      -0.017731,
      0.005593,
      -0.059533,
      0.10864,
      0.126646,
      -0.022683,
      0.021695,
      0.003794,
      0.06565,
      0.083266,
      0.010826,
      0.009566,
      0.000575,
      -0.020662,
      0.039942,
      0.018335,
      0.037541,
      -0.005792
    ]
  },
  {
    "id": "v5-doc-080",
    "title": "File Uploading",
    "content": "# File uploads in FeathersJS\n\nOver the last months we at [ciancoders.com](https://ciancoders.com/) have been working in a new SPA project using Feathers and React, the combination of those two turns out to be **just amazing**.\n\nRecently we were struggling to find a way to upload files without having to write a separate Express middleware or having to (re)write a complex Feathers service.\n\n## Our Goals\n\nWe want to implement an upload service to accomplish a few important things:\n\n1. It has to handle large files (+10MB).\n2. It needs to work with the app's authentication and authorization.\n3. The files need to be validated.\n4. At the moment there is no third party storage service involved, but this will change in the near future, so it has to be prepared.\n5. It has to show the upload progress.\n\nThe plan is to upload the files to a feathers service so we can take advantage of hooks for authentication, authorization and validation, and for service events.\n\nFortunately, there exists a file storage service: [feathers-blob](https://github.com/feathersjs/feathers-blob). With it we can meet our goals, but (spoiler alert) it isn't an ideal solution.  We discuss some of its problems below.\n\n\n## Basic upload with feathers-blob and feathers-client\n\nFor the sake of simplicity, we will be working over a very basic feathers server, with just the upload service.\n\nLets look at the server code:\n\n```javascript\n/* --- server.js --- */\n\nconst feathers = require('@feathersjs/feathers');\nconst express = require('@feathersjs/express');\nconst socketio = require('@feathersjs/socketio');\n\n// feathers-blob service\nconst blobService = require('feathers-blob');\n// Here we initialize a FileSystem storage,\n// but you can use feathers-blob with any other\n// storage service like AWS or Google Drive.\nconst fs = require('fs-blob-store');\nconst blobStorage = fs(__dirname + '/uploads');\n\n\n// Feathers app\nconst app = express(feathers());\n\n// Parse HTTP JSON bodies\napp.use(express.json());\n// Parse URL-encoded params\napp.use(express.urlencoded({ extended: true }));\n// Add REST API support\napp.configure(express.rest());\n// Configure Socket.io real-time APIs\napp.configure(socketio());\n\n\n// Upload Service\napp.use('/uploads', blobService({Model: blobStorage}));\n\n\n// Register a nicer error handler than the default Express one\napp.use(express.errorHandler());\n\n// Start the server\napp.listen(3030, function(){\n    console.log('Feathers app started at localhost:3030')\n});\n```\n\nLet's look at this implemented in the `@feathersjs/cli` generated server code:\n\n```javascript\n/* --- /src/services/uploads/uploads.service.js --- */\n\n// Initializes the `uploads` service on path `/uploads'\n\nconst createModel = require('../../models/uploads.model');\nconst hooks = require('./uploads.hooks');\nconst filters = require('./uploads.filters');\n\n\n// feathers-blob service\nconst blobService = require('feathers-blob');\n// Here we initialize a FileSystem storage,\n// but you can use feathers-blob with any other\n// storage service like AWS or Google Drive.\nconst fs = require('fs-blob-store');\n\n\n// File storage location. Folder must be created before upload.\n// Example: './uploads' will be located under feathers app top level.\nconst blobStorage = fs('./uploads');\n\nmodule.exports = function() {\n  const app = this;\n  const Model = createModel(app);\n  const paginate = app.get('paginate');\n\n  // Initialize our service with any options it requires\n  app.use('/uploads', blobService({ Model: blobStorage}));\n\n  // Get our initialized service so that we can register hooks and filters\n  const service = app.service('uploads');\n\n  service.hooks(hooks);\n\n  if (service.filter) {\n    service.filter(filters);\n  }\n};\n```\n\n`feathers-blob` works over abstract-blob-store, which is an abstract interface to various storage backends, such as filesystem, AWS, or Google Drive. It only accepts and retrieves files encoded as dataURI strings.\n\nJust like that we have our backend ready, go ahead and POST something to localhost:3030/u\n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "file",
      "uploading",
      "uploads",
      "feathersjs",
      "last",
      "months",
      "ciancoders",
      "com",
      "https",
      "working",
      "new",
      "spa",
      "project",
      "using",
      "feathers",
      "react",
      "combination",
      "two",
      "turns",
      "amazing",
      "recently",
      "struggling",
      "find",
      "way",
      "upload",
      "files",
      "without",
      "having",
      "write",
      "separate",
      "express",
      "middleware",
      "re",
      "complex",
      "service",
      "goals",
      "want",
      "implement",
      "accomplish",
      "important",
      "things",
      "handle",
      "large",
      "10mb",
      "needs",
      "work",
      "app",
      "authentication",
      "authorization",
      "need",
      "validated",
      "moment",
      "third",
      "party",
      "storage",
      "involved",
      "change",
      "near",
      "future",
      "prepared",
      "show",
      "progress",
      "plan",
      "take",
      "advantage",
      "hooks",
      "validation",
      "events",
      "fortunately",
      "exists",
      "blob",
      "github",
      "meet",
      "spoiler",
      "alert",
      "isn",
      "ideal",
      "solution",
      "discuss",
      "problems",
      "basic",
      "client",
      "sake",
      "simplicity",
      "server",
      "lets",
      "look",
      "code",
      "javascript",
      "js",
      "const",
      "require",
      "socketio",
      "blobservice",
      "initialize",
      "filesystem",
      "use",
      "like",
      "aws",
      "google",
      "drive",
      "fs",
      "store",
      "blobstorage",
      "dirname",
      "parse",
      "http",
      "json",
      "bodies",
      "url",
      "encoded",
      "params",
      "urlencoded",
      "extended",
      "true",
      "add",
      "rest",
      "api",
      "support",
      "configure",
      "socket",
      "io",
      "real",
      "time",
      "apis",
      "model",
      "register",
      "nicer",
      "error",
      "handler",
      "default",
      "one",
      "errorhandler",
      "start",
      "listen",
      "3030",
      "function",
      "console",
      "log",
      "started",
      "localhost",
      "let",
      "implemented",
      "cli",
      "generated",
      "src",
      "services",
      "initializes",
      "path",
      "createmodel",
      "models",
      "filters",
      "location",
      "folder",
      "created",
      "example",
      "located",
      "top",
      "level",
      "module",
      "exports",
      "paginate",
      "get",
      "options",
      "requires",
      "initialized",
      "if",
      "filter",
      "works",
      "abstract",
      "interface",
      "various",
      "backends",
      "accepts",
      "retrieves",
      "datauri",
      "strings",
      "backend",
      "ready",
      "go",
      "ahead",
      "post",
      "something",
      "content",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "cookbook",
    "source": {
      "path": "cookbook/express/file-uploading.md"
    },
    "tags": [
      "upload",
      "files",
      "multer",
      "express"
    ],
    "embedding": [
      -0.119938,
      0.011243,
      0.003316,
      -0.004866,
      0.045508,
      -0.059653,
      0.016245,
      0.003962,
      -0.001647,
      0.081074,
      -0.039822,
      0.091683,
      -0.003689,
      0.064043,
      -0.034957,
      0.00903,
      -0.008393,
      -0.025155,
      -0.045013,
      0.015741,
      -0.0258,
      -0.059481,
      0.069483,
      0.049312,
      -0.01785,
      -0.046615,
      -0.03738,
      -0.035345,
      -0.046654,
      -0.011374,
      0.088381,
      -0.059676,
      -0.065774,
      -0.022417,
      -0.019543,
      0.080632,
      0.039215,
      -0.080179,
      -0.034948,
      -0.06705,
      0.018805,
      0.008486,
      -0.070421,
      0.037473,
      -0.037043,
      -0.04411,
      0.051793,
      -0.008142,
      -0.017188,
      0.042874,
      -0.035933,
      -0.083122,
      -0.069295,
      0.064175,
      -0.033182,
      -0.015747,
      -0.072311,
      -0.046669,
      -0.073281,
      -0.017147,
      -0.001811,
      -0.053622,
      0.016664,
      -0.002635,
      0.029852,
      0.100782,
      0.011386,
      0.027868,
      0.024692,
      -0.068859,
      0.026565,
      0.029963,
      -0.096911,
      0.021327,
      -0.042403,
      -0.025754,
      0.018975,
      0.063056,
      0.052294,
      -0.064198,
      0.032698,
      -0.061876,
      0.087996,
      0.047167,
      -0.030588,
      -0.022007,
      -0.020675,
      0.021537,
      -0.039899,
      -0.068274,
      0.028369,
      0.062251,
      0.0639,
      0.006301,
      0.058956,
      0.016953,
      -0.033812,
      0.075859,
      -0.039166,
      0.012339,
      -0.028183,
      0.026856,
      0.023696,
      -0.086765,
      0.094656,
      -0.015747,
      0.046441,
      -0.025771,
      -0.005055,
      0.019442,
      -0.03368,
      -0.048338,
      -0.036258,
      -0.020266,
      0.022501,
      0.081574,
      -0.059751,
      0.039241,
      -0.025161,
      0.032195,
      0.120229,
      -0.025172,
      -0.009033,
      -0.026184,
      0.067512,
      0.006886,
      0.017082,
      0,
      -0.008917,
      0.047949,
      0.038672,
      0.122637,
      -0.003225,
      -0.081031,
      0.017402,
      -0.009051,
      -0.14021,
      0.059925,
      -0.058091,
      0.097663,
      -0.003021,
      -0.000336,
      0.052799,
      -0.081153,
      0.023578,
      0.012549,
      0.135363,
      -0.006411,
      -0.038036,
      -0.043856,
      -0.058658,
      0.004498,
      0.050474,
      -0.020226,
      0.027421,
      -0.037074,
      0.024913,
      -0.009278,
      0.086233,
      -0.102062,
      0.043024,
      0.047488,
      -0.046773,
      -0.045401,
      -0.079724,
      -0.071155,
      -0.031026,
      0.016357,
      0.109395,
      -0.034047,
      -0.095253,
      0.096093,
      -0.088366,
      -0.013544,
      -0.057945,
      -0.000962,
      0.038317,
      0.045605,
      0.077404,
      0.035257,
      -0.009727,
      -0.005695,
      0.035692,
      0.007209,
      -0.00008,
      -0.062638,
      0.00524,
      -0.073679,
      0.026568,
      -0.111293,
      -0.036558,
      0.001599,
      0.010637,
      -0.07283,
      -0.002214,
      0.014548,
      0.017394,
      0.035899,
      -0.00871,
      0.033392,
      -0.005327,
      -0.039276,
      0.000476,
      -0.0437,
      -0.013593,
      0.029276,
      -0.000742,
      -0.03098,
      -0.033848,
      -0.05718,
      -0.017365,
      0.073827,
      0.024866,
      -0.026145,
      -0.009755,
      0.003732,
      -0.03508,
      -0.025748,
      0.025176,
      0.072689,
      0.069446,
      -0.06726,
      -0.013189,
      0,
      0.015646,
      -0.065369,
      -0.083927,
      0.052191,
      0.046164,
      0.064977,
      0.097225,
      0.020688,
      0.040148,
      0.017967,
      -0.096856,
      0.02169,
      -0.013331,
      -0.064624,
      -0.096731,
      0.010663,
      -0.064567,
      -0.034767,
      0.049192,
      -0.042482,
      -0.046731,
      0.044972,
      0.097986,
      0.064173,
      -0.015191,
      0.07884,
      -0.028107,
      0.012193,
      -0.025662,
      -0.006343,
      -0.030759,
      -0.055026,
      0.008088,
      -0.10676,
      -0.042394,
      -0.050405,
      0.065657,
      0.169397,
      -0.024392,
      0.044662,
      0.005434,
      -0.024874,
      -0.073084,
      -0.042515,
      0.031593,
      -0.08248,
      -0.065354,
      0.037643,
      -0.056225,
      0.03585,
      -0.015697,
      -0.067784,
      0.048045,
      0.012648,
      0.04811,
      0.048636,
      0.056023,
      -0.058276,
      -0.022152,
      0.065424,
      0.051991,
      -0.053134,
      0.031777,
      0.027872,
      -0.007913,
      0.013287,
      -0.013286,
      -0.041333,
      -0.037709,
      0.056029,
      -0.038581,
      -0.04004,
      0.010069,
      0.00912,
      0.090384,
      -0.018091,
      0.070161,
      -0.07614,
      0.090988,
      0.000545,
      -0.00605,
      0.091499,
      0.009397,
      0.053333,
      0.045086,
      -0.061755,
      0.03001,
      -0.004002,
      0.027618,
      -0.0089,
      -0.049992,
      0.080469,
      0.018538,
      -0.052765,
      0.03932,
      0,
      -0.038847,
      0.078083,
      -0.06465,
      0.016853,
      -0.004892,
      0.062301,
      -0.039395,
      -0.014211,
      0.084795,
      -0.038405,
      0.026984,
      -0.072889,
      -0.048255,
      -0.016047,
      -0.036561,
      -0.008221,
      0.072804,
      -0.021164,
      -0.098287,
      -0.053132,
      -0.01157,
      0.11805,
      0.00658,
      -0.012691,
      0.044834,
      0.035011,
      0.034989,
      0.025955,
      0.006386,
      -0.002026,
      -0.111684,
      -0.03841,
      0.023198,
      -0.010275,
      -0.091759,
      0.016389,
      -0.028797,
      0.0046,
      0.017588,
      0.000639,
      0.079043,
      0.023482,
      0.024062,
      -0.032681,
      0.064894,
      -0.048506,
      0.012905,
      0.002489,
      -0.041955,
      0.082855,
      0.030678,
      -0.03516,
      0.018485,
      0.121289,
      0.039561,
      -0.021839,
      0.034798,
      0.052257,
      0.089278,
      0.039294,
      0.083161,
      -0.000262,
      0.027663,
      0.020196
    ]
  },
  {
    "id": "v5-doc-081",
    "title": "View Engine",
    "content": "# Server Side Rendering\n\nSince Feathers is just an extension of Express it's really simple to render templated views on the server with data from your Feathers services. There are a few different ways that you can structure your app so this guide will show you 3 typical ways you might have your Feathers app organized.\n\n## Rendering views from services\n\nYou probably already know that when you register a Feathers service, Feathers creates RESTful endpoints for that service automatically. Well, really those are just Express routes, so you can define your own as well.\n\n> **ProTip:** Your own defined REST endpoints won't work with hooks and won't emit socket events. If you find you need that functionality it's probably better for you to turn your endpoints into a minimal Feathers service.\n\nLet's say you want to render a list of messages from most recent to oldest using the [Pug](https://pugjs.org/) template engine.\n\n```js\n// You've set up your main Feathers app already\n\n// Register your view engine\napp.set('view engine', 'pug');\n\n// Register your message service\napp.use('/api/messages', memory());\n\n// Inside your main Feathers app\napp.get('/messages', function(req, res, next){\n  // You namespace your feathers service routes so that\n  // don't get route conflicts and have nice URLs.\n  app.service('api/messages')\n    .find({ query: {$sort: { updatedAt: -1 } } })\n    .then(result => res.render('message-list', result.data))\n    .catch(next);\n});\n```\n\nSimple right? We've now rendered a list of messages using the `/views/message-list.pug` view template. All your hooks will get triggered just like they would normally so you can use hooks to pre-filter your data and keep your template rendering routes super tight. See [Using Template Engines with Express](https://expressjs.com/en/guide/using-template-engines.html) for more information.\n\n> **ProTip:** If you call a Feathers service \"internally\" (ie. not over sockets or REST) you won't have a `context.params.provider` attribute. This allows you to have hooks only execute when services are called externally vs. from your own code.\n\n## Using authentication\n\nFeathers is by default stateless and does not use any sessions. You already can protect Express endpoints with the [express.authenticate](../../api/express.md#express-authenticate) middleware, however this will only work when passing the `Authorization` header (usually with a JWT) which a normal browser request does not support.\n\nIn order to render authenticated pages, [express-session](https://www.npmjs.com/package/express-session) can be used to add the authentication information to the (browser) session:\n\n> npm i express-session --save\n\nNow you can add the following to `src/middleware/index.js|ts`:\n\n```js\nconst session = require('express-session');\nconst { authenticate } = require('@feathersjs/express');\n\n// This sets `req.authentication` from the information added to the session\nconst setSessionAuthentication = (req, res, next) => {\n  req.authentication = req.session.authentication;\n  next();\n};\n\nmodule.exports = function (app) {\n  // Initialize Express-session - might have to be configured\n  // with a persisten storage adapter (like Redis)\n  app.use(session({\n    secret: 'session-secret',\n    saveUninitialized: false,\n    resave: true\n  }));\n\n  // An endpoint that you can POST to with `email` and `password` that\n  // will then perform a local user authentication\n  // e.g <form action=\"/login\" method=\"post\"></form>\n  app.post('/login', async (req, res, next) => {\n    try {\n      const { email, password } = req.body;\n      // Run normal local authentication through our service\n      const { accessToken } = await app.service('authentication').create({\n        strategy: 'local',\n        email,\n        password\n      });\n\n      // Register the JWT authentication information on the session\n      req.session.authentication = {\n        strategy: 'jwt',\n        accessToken\n      };\n\n      // Redirect to an authenticated page\n      res.redirect(\n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "view",
      "engine",
      "server",
      "side",
      "rendering",
      "since",
      "feathers",
      "extension",
      "express",
      "really",
      "simple",
      "render",
      "templated",
      "views",
      "data",
      "services",
      "different",
      "ways",
      "structure",
      "app",
      "guide",
      "show",
      "typical",
      "organized",
      "probably",
      "already",
      "know",
      "register",
      "service",
      "creates",
      "restful",
      "endpoints",
      "automatically",
      "well",
      "routes",
      "define",
      "protip",
      "defined",
      "rest",
      "won",
      "work",
      "hooks",
      "emit",
      "socket",
      "events",
      "if",
      "find",
      "need",
      "functionality",
      "better",
      "turn",
      "into",
      "minimal",
      "let",
      "say",
      "want",
      "list",
      "messages",
      "recent",
      "oldest",
      "using",
      "pug",
      "https",
      "pugjs",
      "org",
      "template",
      "js",
      "ve",
      "set",
      "main",
      "message",
      "use",
      "api",
      "memory",
      "inside",
      "get",
      "function",
      "req",
      "res",
      "next",
      "namespace",
      "don",
      "route",
      "conflicts",
      "nice",
      "urls",
      "query",
      "sort",
      "updatedat",
      "result",
      "catch",
      "right",
      "now",
      "rendered",
      "triggered",
      "like",
      "normally",
      "pre",
      "filter",
      "keep",
      "super",
      "tight",
      "see",
      "engines",
      "expressjs",
      "com",
      "en",
      "html",
      "information",
      "call",
      "internally",
      "ie",
      "sockets",
      "context",
      "params",
      "provider",
      "attribute",
      "allows",
      "execute",
      "called",
      "externally",
      "vs",
      "code",
      "authentication",
      "default",
      "stateless",
      "sessions",
      "protect",
      "authenticate",
      "md",
      "middleware",
      "however",
      "passing",
      "authorization",
      "header",
      "usually",
      "jwt",
      "normal",
      "browser",
      "request",
      "support",
      "order",
      "authenticated",
      "pages",
      "session",
      "www",
      "npmjs",
      "package",
      "used",
      "add",
      "npm",
      "save",
      "following",
      "src",
      "index",
      "ts",
      "const",
      "require",
      "feathersjs",
      "sets",
      "added",
      "setsessionauthentication",
      "module",
      "exports",
      "initialize",
      "configured",
      "persisten",
      "storage",
      "adapter",
      "redis",
      "secret",
      "saveuninitialized",
      "false",
      "resave",
      "true",
      "endpoint",
      "post",
      "email",
      "password",
      "perform",
      "local",
      "user",
      "form",
      "action",
      "login",
      "method",
      "async",
      "try",
      "body",
      "run",
      "accesstoken",
      "await",
      "create",
      "strategy",
      "redirect",
      "page",
      "content",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "cookbook",
    "source": {
      "path": "cookbook/express/view-engine.md"
    },
    "tags": [
      "view",
      "template",
      "ejs",
      "express"
    ],
    "embedding": [
      -0.054219,
      0.002667,
      0.023012,
      0.052232,
      -0.024788,
      0.020276,
      -0.00006,
      -0.064477,
      0.035418,
      -0.033775,
      -0.072168,
      0.007232,
      -0.097999,
      0.046204,
      0.002253,
      0.011154,
      0.041633,
      -0.073715,
      0.061318,
      0.018048,
      0.000034,
      -0.019829,
      0.006493,
      0.05646,
      -0.019757,
      -0.021283,
      0.023498,
      0.025516,
      0.032855,
      -0.025727,
      0.086115,
      -0.065541,
      -0.08431,
      0.01407,
      -0.059885,
      0.086346,
      0.016972,
      -0.072217,
      -0.050973,
      -0.053067,
      0.050253,
      -0.013708,
      -0.110944,
      -0.034035,
      0.059229,
      -0.046767,
      0.033226,
      -0.042258,
      -0.032816,
      0.042176,
      0.002867,
      -0.049355,
      -0.067243,
      -0.002208,
      0.028332,
      0.01417,
      -0.07992,
      -0.060136,
      -0.050812,
      -0.062437,
      0.038198,
      -0.043282,
      0.073945,
      0.02166,
      -0.016767,
      -0.028204,
      0.004382,
      0.04868,
      0.043971,
      -0.066034,
      -0.037919,
      -0.052745,
      -0.054317,
      -0.111738,
      -0.054196,
      0.086488,
      -0.027206,
      -0.077558,
      -0.022552,
      -0.042963,
      0.025206,
      -0.017089,
      0.003158,
      0.125423,
      0.009788,
      0.036402,
      -0.033591,
      -0.007599,
      -0.043907,
      -0.074589,
      0.066767,
      -0.000613,
      0.002888,
      0.046349,
      0.064216,
      0.028082,
      -0.041885,
      0.02237,
      -0.005838,
      0.01773,
      -0.003314,
      0.020947,
      0.034724,
      -0.010673,
      0.100358,
      -0.025971,
      -0.062046,
      -0.003642,
      -0.09144,
      -0.022456,
      -0.084531,
      0.034074,
      -0.001084,
      -0.009094,
      0.036875,
      0.000688,
      0.027452,
      -0.035433,
      0.024142,
      0.074136,
      0.125739,
      -0.00457,
      0.031997,
      0.043422,
      0.061956,
      0.034482,
      -0.036195,
      0,
      0.063059,
      0.019485,
      0.003465,
      0.032034,
      0.029772,
      -0.044663,
      -0.028536,
      -0.004649,
      -0.039427,
      0.102972,
      -0.010281,
      0.098644,
      0.07333,
      -0.006156,
      0.043243,
      -0.056558,
      0.033909,
      0.029881,
      0.087688,
      -0.060407,
      -0.106613,
      -0.035318,
      -0.065879,
      -0.047366,
      0.014428,
      0.090593,
      -0.02184,
      0.04088,
      -0.133755,
      -0.018118,
      0.13519,
      -0.057926,
      0.014338,
      0.031007,
      -0.030405,
      -0.018833,
      -0.002426,
      -0.074162,
      -0.074547,
      0.067784,
      0.058572,
      -0.039907,
      -0.077257,
      0.00035,
      -0.07487,
      0.018933,
      -0.063758,
      0.059653,
      0.053584,
      -0.019233,
      0.041632,
      0.020598,
      0.02974,
      -0.008786,
      0.073664,
      -0.025794,
      0.00357,
      -0.050373,
      0.019596,
      -0.032918,
      -0.081168,
      -0.087314,
      -0.03816,
      -0.044009,
      0.015151,
      -0.017865,
      -0.00136,
      0.035956,
      -0.065001,
      0.061754,
      0.030412,
      0.061979,
      0.024154,
      -0.050788,
      0.036516,
      0.017043,
      -0.017378,
      0.082263,
      0.056285,
      -0.022259,
      -0.011488,
      0.018939,
      -0.029311,
      0.031186,
      0.081034,
      -0.025415,
      0.047254,
      -0.011285,
      -0.020295,
      0.032304,
      -0.041701,
      0.045896,
      0.103916,
      -0.105698,
      -0.068128,
      0,
      -0.009972,
      -0.016908,
      -0.123184,
      0.030748,
      0.014107,
      -0.019273,
      0.063413,
      0.054674,
      0.02963,
      0.047248,
      -0.059184,
      -0.012778,
      0.045787,
      0.05977,
      -0.06298,
      0.100368,
      -0.036536,
      -0.100063,
      0.046828,
      -0.065305,
      -0.081814,
      0.056285,
      0.038326,
      -0.047037,
      -0.063386,
      0.106476,
      0.065831,
      -0.086099,
      -0.047911,
      -0.049179,
      -0.015569,
      -0.095124,
      0.069789,
      0.011752,
      -0.053094,
      0.022081,
      0.053637,
      0.070062,
      -0.005248,
      -0.007449,
      0.031126,
      -0.057273,
      -0.059301,
      -0.031588,
      -0.045899,
      -0.001712,
      -0.055569,
      0.025261,
      -0.052793,
      0.004523,
      -0.023444,
      -0.002382,
      -0.009207,
      0.072055,
      -0.050285,
      0.036796,
      0.057732,
      -0.061803,
      0.019101,
      0.024293,
      0.042865,
      -0.100101,
      0.018003,
      0.012539,
      0.034009,
      -0.056904,
      -0.087672,
      -0.114677,
      -0.013396,
      -0.04877,
      -0.041336,
      -0.026094,
      -0.030751,
      0.010168,
      0.044554,
      0.009639,
      0.059869,
      -0.070886,
      0.121444,
      0.027802,
      -0.075433,
      0.01969,
      0.022844,
      0.015128,
      0.044795,
      -0.100891,
      -0.044102,
      0.016972,
      0.029516,
      -0.062968,
      -0.041443,
      0.05015,
      0.001604,
      0.022265,
      0.062405,
      0,
      -0.039241,
      0.006478,
      -0.02901,
      0.007021,
      -0.029837,
      0.043715,
      0.021935,
      -0.012183,
      0.016704,
      0.034779,
      -0.027067,
      -0.018006,
      0.011591,
      0.008853,
      0.084641,
      0.033018,
      0.036874,
      -0.020425,
      -0.063467,
      -0.072243,
      -0.033637,
      0.151409,
      -0.011015,
      -0.039145,
      0.033879,
      0.018305,
      0.066202,
      0.020059,
      0.018129,
      0.007563,
      -0.074184,
      0.018385,
      0.065968,
      0.029237,
      -0.030665,
      -0.027537,
      -0.016807,
      -0.003524,
      0.031962,
      0.121223,
      0.017349,
      -0.045657,
      -0.030257,
      -0.008491,
      0.061942,
      0.038726,
      0.046547,
      -0.030226,
      0.008234,
      0.120635,
      0.018884,
      -0.039249,
      0.046015,
      -0.01315,
      0.016386,
      0.010086,
      0.068944,
      -0.017495,
      0.075686,
      0.021889,
      0.040627,
      0.04076,
      0.027289,
      -0.022545
    ]
  },
  {
    "id": "v5-doc-082",
    "title": "Client Testing",
    "content": "# Client/server testing\n\nYou can write tests which start up both a server for your app, and a Feathers client which your test can use to call the server. Such tests can expose faults in the interaction between the client and the server. They are also useful in testing the authentication of requests from the client. Install it as a development dependency:\n\n```\nnpm install @feathersjs/client --save-dev\n```\n\nTest `test/services/users.test.js` from above runs on the server. We convert it, in the following `tests/services/client-users.test.js`, so the tests are run on the client instead of on the server. This also causes client authentication to be tested.\n\n```js\nconst assert = require('assert');\nconst feathersClient = require('@feathersjs/client');\nconst io = require('socket.io-client');\nconst app = require('../../src/app');\n\nconst host = app.get('host');\nconst port = app.get('port');\nconst email = 'login@example.com';\nconst password = 'login';\n\ndescribe('\\'users\\' service - client', function () {\n  this.timeout(10000);\n  let server;\n  let client;\n\n  before(async () => {\n    await app.service('users').create({ email, password });\n\n    server = app.listen(port);\n    server.on('listening', async () => {\n      // eslint-disable-next-line no-console\n      console.log('Feathers application started on http://%s:%d', host, port);\n    });\n\n    client = await makeClient(host, port, email, password);\n  });\n\n  after(() => {\n    client.logout();\n    server.close();\n  });\n\n  describe('Run tests using client and server', () => {\n    it('registered the service', () => {\n      const service = client.service('users');\n\n      assert.ok(service, 'Registered the service');\n    });\n\n    it('creates a user, encrypts password and adds gravatar', async () => {\n      const user = await client.service('users').create({\n        email: 'testclient@example.com',\n        password: 'secret'\n      });\n\n      // Verify Gravatar has been set to what we'd expect\n      assert.equal(user.avatar, 'https://s.gravatar.com/avatar/1b9c869fa7a93e59463c31a377fe0cf6?s=60');\n      // Makes sure the password got encrypted\n      assert.ok(user.password !== 'secret');\n    });\n\n    it('removes password for external requests', async () => {\n      // Setting `provider` indicates an external request\n      const params = { provider: 'rest' };\n\n      const user = await client.service('users').create({\n        email: 'testclient2@example.com',\n        password: 'secret'\n      }, params);\n\n      // Make sure password has been removed\n      assert.ok(!user.password);\n    });\n  });\n});\n\nasync function makeClient(host, port, email, password) {\n  const client = feathersClient();\n  const socket = io(`http://${host}:${port}`, {\n    transports: ['websocket'], forceNew: true, reconnection: false, extraHeaders: {}\n  });\n  client.configure(feathersClient.socketio(socket));\n  client.configure(feathersClient.authentication({\n    storage: localStorage()\n  }));\n\n  await client.authenticate({\n    strategy: 'local',\n    email,\n    password,\n  });\n\n  return client;\n}\n\nfunction localStorage () {\n  const store = {};\n\n  return {\n    setItem (key, value) {\n      store[key] = value;\n    },\n    getItem (key) {\n      return store[key];\n    },\n    removeItem (key) {\n      delete store[key];\n    }\n  };\n}\n```\n\nWe first make a call on the *server* to create a new user. We then start up a server for our app. Finally the function `makeClient` is called to create a Feathers client and authenticate it using the newly created user.\n\nThe individual tests remain unchanged except that the service calls are now made on the client (`client.service(...).create`) instead of on the server (`app.service(...).create`).\n\nThe `describe('Run tests using client and server',` statement stops a new server and client from being created for each test. This results in the test module running noticeably faster, though the tests are now exposed to potential interactions. You can remove the statement to isolate the tests from one another.",
    "version": "v5",
    "tokens": [
      "client",
      "testing",
      "server",
      "write",
      "tests",
      "start",
      "app",
      "feathers",
      "test",
      "use",
      "call",
      "expose",
      "faults",
      "interaction",
      "also",
      "useful",
      "authentication",
      "requests",
      "install",
      "development",
      "dependency",
      "npm",
      "feathersjs",
      "save",
      "dev",
      "services",
      "users",
      "js",
      "runs",
      "convert",
      "following",
      "run",
      "instead",
      "causes",
      "tested",
      "const",
      "assert",
      "require",
      "feathersclient",
      "io",
      "socket",
      "src",
      "host",
      "get",
      "port",
      "email",
      "login",
      "example",
      "com",
      "password",
      "describe",
      "service",
      "function",
      "timeout",
      "10000",
      "let",
      "async",
      "await",
      "create",
      "listen",
      "listening",
      "eslint",
      "disable",
      "next",
      "line",
      "console",
      "log",
      "application",
      "started",
      "http",
      "makeclient",
      "logout",
      "close",
      "using",
      "registered",
      "ok",
      "creates",
      "user",
      "encrypts",
      "adds",
      "gravatar",
      "testclient",
      "secret",
      "verify",
      "set",
      "expect",
      "equal",
      "avatar",
      "https",
      "1b9c869fa7a93e59463c31a377fe0cf6",
      "60",
      "makes",
      "sure",
      "got",
      "encrypted",
      "removes",
      "external",
      "setting",
      "provider",
      "indicates",
      "request",
      "params",
      "rest",
      "testclient2",
      "make",
      "removed",
      "transports",
      "websocket",
      "forcenew",
      "true",
      "reconnection",
      "false",
      "extraheaders",
      "configure",
      "socketio",
      "storage",
      "localstorage",
      "authenticate",
      "strategy",
      "local",
      "return",
      "store",
      "setitem",
      "key",
      "value",
      "getitem",
      "removeitem",
      "delete",
      "first",
      "new",
      "finally",
      "called",
      "newly",
      "created",
      "individual",
      "remain",
      "unchanged",
      "except",
      "calls",
      "now",
      "made",
      "statement",
      "stops",
      "results",
      "module",
      "running",
      "noticeably",
      "faster",
      "though",
      "exposed",
      "potential",
      "interactions",
      "remove",
      "isolate",
      "one",
      "another"
    ],
    "category": "cookbook",
    "source": {
      "path": "cookbook/general/client-test.md"
    },
    "tags": [
      "testing",
      "client",
      "mock"
    ],
    "embedding": [
      -0.09026,
      0.003428,
      0.018003,
      0.047315,
      0.011345,
      -0.110258,
      0.018791,
      -0.033627,
      0.022799,
      0.005262,
      -0.019789,
      0.072984,
      -0.050122,
      0.067324,
      0.054604,
      -0.02794,
      0.046617,
      -0.026052,
      0.099683,
      0.010444,
      -0.079888,
      -0.071302,
      0.045582,
      0.022296,
      -0.052436,
      -0.095812,
      0.021284,
      0.003568,
      0.000084,
      0.030919,
      0.08194,
      -0.036649,
      -0.0949,
      -0.023031,
      -0.119357,
      0.078944,
      0.008004,
      -0.043033,
      -0.068303,
      -0.041239,
      0.01893,
      -0.029033,
      -0.058911,
      -0.026841,
      0.049104,
      -0.028898,
      -0.00263,
      0.006763,
      -0.029932,
      0.065255,
      -0.057311,
      -0.059258,
      -0.060914,
      0.033565,
      -0.020592,
      0.015712,
      -0.010559,
      0.000312,
      -0.014367,
      0.0334,
      -0.01467,
      -0.055572,
      0.048083,
      0.021149,
      0.059158,
      0.033174,
      -0.002957,
      0.02298,
      0.011998,
      -0.029976,
      0.010923,
      -0.004207,
      -0.032664,
      -0.043936,
      -0.041117,
      0.059581,
      -0.066545,
      -0.036983,
      0.058349,
      0.060393,
      -0.050055,
      -0.071187,
      -0.017052,
      0.076405,
      -0.017088,
      0.087503,
      0.066065,
      -0.010097,
      -0.060869,
      -0.048923,
      0.105957,
      0.034438,
      -0.0998,
      0.069178,
      0.069713,
      0.007775,
      -0.002232,
      0.082245,
      -0.013401,
      0.019421,
      -0.011142,
      -0.03943,
      0.029834,
      -0.054272,
      0.041952,
      0.044922,
      -0.015036,
      -0.120205,
      0.033333,
      0.039385,
      -0.033085,
      -0.022592,
      -0.012709,
      0.023148,
      0.02511,
      -0.006465,
      0.006874,
      -0.009653,
      -0.023083,
      0.11893,
      0.069614,
      -0.01199,
      0.047147,
      0.021426,
      0.087214,
      0.065699,
      -0.00026,
      0,
      0.042598,
      -0.010339,
      0.010209,
      0.092373,
      0.009,
      -0.014088,
      0.058288,
      0.008835,
      -0.120072,
      0.029976,
      0.012708,
      0.063376,
      0.09509,
      -0.050194,
      0.070781,
      -0.004939,
      0.062806,
      -0.077564,
      0.107747,
      0.031585,
      -0.019377,
      -0.056792,
      0.001608,
      0.008069,
      0.004634,
      -0.038911,
      -0.021944,
      0.000751,
      -0.069901,
      -0.008139,
      0.10697,
      -0.003157,
      -0.048603,
      0.093145,
      -0.027481,
      -0.01247,
      0.009336,
      -0.028506,
      -0.135304,
      0.035485,
      0.000026,
      -0.055925,
      -0.032862,
      0.052452,
      -0.066781,
      -0.060922,
      -0.092752,
      -0.026846,
      0.101095,
      -0.001831,
      -0.059352,
      0.034727,
      0.021934,
      0.032565,
      0.092392,
      0.024096,
      0.042768,
      -0.067815,
      -0.066765,
      -0.032527,
      -0.037777,
      -0.077502,
      -0.047146,
      -0.055373,
      0.010416,
      -0.046173,
      -0.074212,
      -0.04294,
      -0.025882,
      0.033379,
      0.053746,
      -0.018273,
      -0.011219,
      0.015063,
      -0.042729,
      0.005994,
      -0.010249,
      0.079256,
      0.022696,
      -0.076184,
      0.042107,
      0.024883,
      -0.005928,
      0.109749,
      -0.015077,
      0.001966,
      -0.03338,
      0.003241,
      0.00027,
      -0.02574,
      0.05296,
      0.055538,
      0.066089,
      -0.090818,
      -0.042531,
      0,
      -0.080158,
      -0.015844,
      -0.146524,
      0.113501,
      0.04495,
      -0.042007,
      0.083233,
      -0.016248,
      -0.021495,
      0.05999,
      -0.046344,
      -0.002565,
      0.01682,
      0.065139,
      -0.064195,
      0.052579,
      -0.088489,
      -0.046722,
      0.101783,
      -0.085412,
      -0.041701,
      0.076825,
      0.099213,
      -0.052796,
      -0.116678,
      0.021611,
      -0.002893,
      -0.062954,
      -0.034995,
      -0.03699,
      0.037747,
      0.047851,
      -0.007933,
      0.0257,
      -0.003833,
      -0.017609,
      0.075487,
      0.061456,
      -0.010664,
      -0.011167,
      0.061435,
      -0.029481,
      -0.044356,
      -0.092676,
      -0.014609,
      0.032011,
      -0.032502,
      0.007419,
      -0.028014,
      0.009208,
      -0.010868,
      0.029168,
      0.046748,
      0.026251,
      -0.044885,
      0.002494,
      0.025322,
      -0.030629,
      0.034639,
      0.045798,
      0.070548,
      -0.06068,
      0.025048,
      0.088991,
      -0.030431,
      0.009781,
      -0.063318,
      0.054462,
      0.077528,
      0.025495,
      -0.108857,
      0.024581,
      0.010086,
      -0.002156,
      0.055387,
      0.013812,
      -0.042797,
      -0.076556,
      0.111462,
      -0.009257,
      -0.03494,
      0.008896,
      -0.03627,
      0.033174,
      -0.057404,
      -0.050703,
      0.01873,
      0.004786,
      0.005228,
      -0.027281,
      0.004977,
      0.039107,
      -0.059625,
      -0.0845,
      0.059915,
      0,
      -0.004956,
      -0.023429,
      -0.04432,
      0.019535,
      -0.039811,
      0.037481,
      0.007475,
      -0.040599,
      0.029569,
      0.093366,
      -0.100111,
      -0.027554,
      0.028981,
      -0.014704,
      0.028789,
      0.028266,
      0.015495,
      0.03952,
      -0.050271,
      -0.038112,
      -0.02041,
      0.096024,
      -0.012366,
      0.033368,
      -0.010661,
      0.025618,
      0.092503,
      0.043099,
      -0.042597,
      -0.029705,
      -0.145591,
      0.003777,
      0.025229,
      -0.072332,
      -0.037425,
      0.038299,
      -0.076935,
      0.00053,
      0.062984,
      0.061602,
      -0.078272,
      -0.013387,
      0.039457,
      -0.013321,
      0.002342,
      -0.064366,
      0.02195,
      0.003016,
      -0.000821,
      0.018666,
      0.010775,
      0.007529,
      -0.015339,
      0.013051,
      0.023824,
      0.018898,
      0.009232,
      -0.01386,
      -0.004104,
      -0.026182,
      0.035381,
      0.068839,
      0.028038,
      -0.055872
    ]
  },
  {
    "id": "v5-doc-083",
    "title": "Scaling",
    "content": "# Scaling\n\nDepending on your requirements, your feathers application may need to provide high availability. Feathers is designed to scale.\n\nThe types of transports used in a feathers application will impact the scaling configuration. For example, a feathers app that uses the `feathers-rest` adapter exclusively will require less scaling configuration because HTTP is a stateless protocol. If using websockets (a stateful protocol) through the `feathers-socketio` or `feathers-primus` adapters, configuration may be more complex to ensure websockets work properly.\n\n## Horizontal Scaling\n\nScaling horizontally refers to either:\n\n- setting up a [cluster](https://nodejs.org/api/cluster.html), or\n- adding more machines to support your application\n\nTo achieve high availability, varying combinations of both strategies may be used.\n\n## Cluster configuration\n\n[Cluster](https://nodejs.org/api/cluster.html) support is built into core NodeJS. Since NodeJS is single threaded, clustering allows you to easily distribute application requests among multiple child processes (and multiple threads). Clustering is a good choice when running feathers in a multi-core environment.\n\nBelow is an example of adding clustering to feathers with the `feathers-socketio` provider. By default, websocket connections begin via a handshake of multiple HTTP requests and are upgraded to the websocket protocol. However, when clustering is enabled, the same worker will not process all HTTP requests for a handshake, leading to HTTP 400 errors. To ensure a successful handshake, force a single worker to process the handshake by disabling the http transport and exclusively using the `websocket` transport.\n\n```js\nimport cluster from 'cluster';\nimport feathers from '@feathersjs/feathers';\nimport socketio from '@feathersjs/socketio';\n\nconst CLUSTER_COUNT = 4;\n\nif (cluster.isMaster) {\n  for (let i = 0; i < CLUSTER_COUNT; i++) {\n    cluster.fork();\n  }\n} else {\n  const app = feathers();\n  // ensure the same worker handles websocket connections\n  app.configure(socketio({\n    transports: ['websocket']\n  }));\n  app.listen(4000);\n}\n```\n\nIn your feathers client code, limit the socket.io-client to the `websocket` transport and disable `upgrade`.\n\n```js\nimport feathers from '@feathersjs/client';\nimport socketio from '@feathersjs/socketio-client';\nimport io from 'socket.io-client';\n\nconst app = feathers()\n  .configure(socketio(\n    io('http://api.feathersjs.com', {\n      transports: ['websocket'],\n      upgrade: false\n    })\n  ));\n```\n## Multiple instances\nWhen running multiple instances of your Feathers application (e.g. on several Heroku Dynos), service events (created, updated, patched, removed and any custom defined events) do not get propagated to other instances for such cases you may want to use: https://github.com/feathersjs-ecosystem/feathers-sync\n\nWhich will use a messaging mechanism to propagate all events to all application instances like redis or RabbitMQ",
    "version": "v5",
    "tokens": [
      "scaling",
      "depending",
      "requirements",
      "feathers",
      "application",
      "need",
      "provide",
      "high",
      "availability",
      "designed",
      "scale",
      "types",
      "transports",
      "used",
      "impact",
      "configuration",
      "example",
      "app",
      "uses",
      "rest",
      "adapter",
      "exclusively",
      "require",
      "less",
      "http",
      "stateless",
      "protocol",
      "if",
      "using",
      "websockets",
      "stateful",
      "socketio",
      "primus",
      "adapters",
      "complex",
      "ensure",
      "work",
      "properly",
      "horizontal",
      "horizontally",
      "refers",
      "setting",
      "cluster",
      "https",
      "nodejs",
      "org",
      "api",
      "html",
      "adding",
      "machines",
      "support",
      "achieve",
      "varying",
      "combinations",
      "strategies",
      "built",
      "into",
      "core",
      "since",
      "single",
      "threaded",
      "clustering",
      "allows",
      "easily",
      "distribute",
      "requests",
      "among",
      "multiple",
      "child",
      "processes",
      "threads",
      "good",
      "choice",
      "running",
      "multi",
      "environment",
      "provider",
      "default",
      "websocket",
      "connections",
      "begin",
      "via",
      "handshake",
      "upgraded",
      "however",
      "enabled",
      "worker",
      "process",
      "leading",
      "400",
      "errors",
      "successful",
      "force",
      "disabling",
      "transport",
      "js",
      "import",
      "feathersjs",
      "const",
      "count",
      "ismaster",
      "let",
      "fork",
      "else",
      "handles",
      "configure",
      "listen",
      "4000",
      "client",
      "code",
      "limit",
      "socket",
      "io",
      "disable",
      "upgrade",
      "com",
      "false",
      "instances",
      "several",
      "heroku",
      "dynos",
      "service",
      "events",
      "created",
      "updated",
      "patched",
      "removed",
      "custom",
      "defined",
      "get",
      "propagated",
      "cases",
      "want",
      "use",
      "github",
      "ecosystem",
      "sync",
      "messaging",
      "mechanism",
      "propagate",
      "like",
      "redis",
      "rabbitmq"
    ],
    "category": "cookbook",
    "source": {
      "path": "cookbook/general/scaling.md"
    },
    "tags": [
      "scaling",
      "cluster",
      "redis",
      "performance"
    ],
    "embedding": [
      -0.036275,
      -0.007875,
      0.011416,
      0.04082,
      -0.000542,
      -0.043489,
      -0.051338,
      -0.013188,
      -0.015592,
      -0.033796,
      -0.03295,
      0.044483,
      -0.026198,
      -0.006712,
      0.046707,
      -0.007658,
      0.05279,
      0.015968,
      -0.049859,
      -0.015393,
      -0.045227,
      -0.092939,
      -0.007709,
      0.025027,
      -0.088522,
      0.00111,
      -0.053244,
      0.014543,
      0.012891,
      -0.012698,
      0.023119,
      -0.018544,
      -0.043947,
      0.025287,
      -0.093856,
      0.067157,
      0.005736,
      -0.104389,
      -0.084338,
      -0.007657,
      0.053327,
      -0.02668,
      -0.080101,
      -0.050864,
      -0.014294,
      -0.06845,
      -0.059745,
      0.04821,
      -0.004527,
      -0.006989,
      0.047554,
      -0.067356,
      -0.072475,
      0.089438,
      -0.013451,
      0.059266,
      -0.003857,
      -0.019992,
      -0.058212,
      -0.028483,
      0.082473,
      -0.010974,
      0.072664,
      0.000715,
      0.044997,
      0.022804,
      0.03023,
      -0.019796,
      -0.0003,
      -0.005995,
      0.053517,
      -0.055303,
      -0.051428,
      0.013973,
      -0.015759,
      0.001117,
      -0.002576,
      -0.034189,
      0.019648,
      0.123613,
      -0.035319,
      0.022885,
      -0.004531,
      0.083802,
      -0.016849,
      -0.01827,
      -0.027661,
      -0.04488,
      -0.012465,
      -0.068668,
      0.034022,
      0.060127,
      -0.007166,
      0.027917,
      0.076166,
      -0.01646,
      -0.07526,
      0.022157,
      0.013902,
      0.008621,
      0.033718,
      -0.044649,
      0.064485,
      -0.042468,
      0.058692,
      -0.019969,
      -0.063443,
      -0.030486,
      0.033601,
      0.033277,
      -0.007536,
      0.055448,
      0.01156,
      0.024254,
      -0.028918,
      0.036326,
      0.038469,
      -0.052195,
      -0.019589,
      0.091368,
      0.073112,
      -0.024145,
      0.084574,
      -0.032937,
      0.081967,
      0.056416,
      -0.090175,
      0,
      -0.054641,
      -0.018079,
      0.036736,
      -0.022669,
      0.044302,
      -0.020066,
      -0.021012,
      -0.049045,
      -0.085439,
      -0.079994,
      -0.027936,
      0.124211,
      0.065786,
      -0.018313,
      0.101933,
      -0.112218,
      0.094853,
      0.048067,
      0.144048,
      -0.017288,
      -0.015466,
      -0.066146,
      -0.034514,
      0.041725,
      0.008887,
      -0.033106,
      -0.004294,
      -0.035469,
      -0.07644,
      0.017566,
      0.092002,
      -0.069322,
      -0.021395,
      -0.002556,
      -0.014869,
      -0.02353,
      -0.012193,
      -0.057304,
      -0.074864,
      0.006864,
      -0.003832,
      0.009403,
      -0.002015,
      -0.012387,
      0.002729,
      0.008882,
      0.004617,
      -0.005243,
      -0.005209,
      -0.055972,
      0.060019,
      -0.024869,
      0.079208,
      -0.020702,
      0.09134,
      0.010307,
      0.06256,
      -0.062646,
      -0.032944,
      -0.021045,
      -0.072388,
      -0.193921,
      -0.032355,
      -0.025408,
      0.096328,
      0.0074,
      -0.032581,
      0.012619,
      -0.065149,
      0.084561,
      0.097141,
      0.044306,
      0.021345,
      0.012339,
      -0.038574,
      0.024952,
      0.006689,
      0.031884,
      -0.012537,
      -0.019443,
      -0.047157,
      0.084449,
      -0.013216,
      0.035365,
      -0.014972,
      -0.037496,
      0.020399,
      0.029737,
      -0.029345,
      0.047536,
      0.029325,
      0.062137,
      0.06783,
      -0.089632,
      -0.08389,
      0,
      -0.0478,
      -0.012673,
      -0.107396,
      0.071617,
      0.032143,
      -0.002792,
      0.040761,
      0.017231,
      0.025007,
      0.034407,
      -0.036811,
      -0.000021,
      0.000919,
      0.006433,
      -0.079058,
      0.052487,
      -0.02755,
      -0.055769,
      0.112602,
      -0.024275,
      0.021357,
      -0.063899,
      0.041852,
      -0.011745,
      -0.012604,
      -0.002286,
      -0.071899,
      -0.064006,
      -0.045507,
      -0.050051,
      -0.010873,
      -0.066622,
      0.077546,
      0.01589,
      0.018485,
      0.011601,
      -0.011427,
      0.053945,
      0.023363,
      -0.047931,
      0.004046,
      -0.019353,
      -0.019047,
      -0.098269,
      0.02,
      -0.004132,
      -0.040749,
      0.018849,
      -0.088943,
      0.015697,
      -0.027367,
      -0.036832,
      0.042352,
      0.080065,
      -0.053786,
      0.070115,
      0.007517,
      0.05523,
      -0.043718,
      0.037091,
      0.059601,
      -0.105977,
      -0.013048,
      0.049634,
      -0.020264,
      -0.016743,
      -0.044719,
      -0.050755,
      -0.04945,
      -0.011913,
      -0.043674,
      0.017933,
      0.042692,
      0.031864,
      -0.07473,
      -0.031756,
      0.053624,
      -0.053831,
      0.083112,
      0.025419,
      -0.154021,
      0.075741,
      0.000033,
      0.029786,
      0.010633,
      0.000494,
      0.07261,
      0.037555,
      0.05117,
      0.049541,
      -0.033959,
      0.029289,
      -0.026121,
      -0.056727,
      -0.001848,
      0,
      -0.038945,
      0.027129,
      -0.077454,
      0.044864,
      0.005038,
      0.017094,
      0.000572,
      -0.036504,
      0.072881,
      0.151675,
      -0.001872,
      -0.028049,
      -0.011702,
      0.01026,
      0.089259,
      0.019806,
      0.060038,
      -0.024289,
      -0.042739,
      -0.057443,
      -0.047841,
      0.100396,
      -0.032453,
      0.052009,
      0.021671,
      0.00815,
      0.067391,
      0.07596,
      -0.029493,
      -0.043777,
      -0.151918,
      0.01679,
      0.021764,
      0.020425,
      -0.052326,
      -0.048577,
      -0.104141,
      0.106046,
      0.075553,
      0.070736,
      0.055834,
      -0.021117,
      0.035069,
      -0.002468,
      0.114205,
      0.03047,
      0.031604,
      0.067379,
      0.000016,
      0.065982,
      0.056147,
      -0.013281,
      0.015086,
      0.008416,
      0.04035,
      0.017495,
      -0.016387,
      -0.017128,
      0.046434,
      0.005078,
      0.049169,
      -0.015186,
      -0.043503,
      -0.014859
    ]
  }
]
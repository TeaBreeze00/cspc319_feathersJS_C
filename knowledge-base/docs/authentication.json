[
  {
    "id": "v5-doc-032",
    "title": "Authentication Overview",
    "content": "# Authentication Overview\n\nThe `@feathersjs/authentication` plugins provide a collection of tools for username/password, JWT and OAuth (GitHub, Facebook etc.) authentication as well as custom authentication mechanisms.\n\nIt consists of the following core modules:\n\n- `@feathersjs/authentication` which includes\n  - The [AuthenticationService](./service.md) that allows to register [authentication strategies](./strategy.md) and create and manage access tokens\n  - The [JWTStrategy](./jwt.md) to use JWTs to make authenticated requests\n  - The [authenticate hook](./hook.md) to limit service calls to an authentication strategy.\n- [Local authentication](./local.md) for local username/password authentication\n- [OAuth authentication](./oauth.md) for Google, GitHub, Facebook etc. authentication\n- [The authentication client](./client.md) to use Feathers authentication on the client.",
    "version": "v5",
    "tokens": [
      "authentication",
      "overview",
      "feathersjs",
      "plugins",
      "provide",
      "collection",
      "tools",
      "username",
      "password",
      "jwt",
      "oauth",
      "github",
      "facebook",
      "etc",
      "well",
      "custom",
      "mechanisms",
      "consists",
      "following",
      "core",
      "modules",
      "includes",
      "authenticationservice",
      "service",
      "md",
      "allows",
      "register",
      "strategies",
      "strategy",
      "create",
      "manage",
      "access",
      "tokens",
      "jwtstrategy",
      "use",
      "jwts",
      "make",
      "authenticated",
      "requests",
      "authenticate",
      "hook",
      "limit",
      "calls",
      "local",
      "google",
      "client",
      "feathers"
    ],
    "category": "authentication",
    "source": {
      "path": "api/authentication/index.md"
    },
    "tags": [
      "authentication",
      "auth",
      "strategies"
    ]
  },
  {
    "id": "v5-doc-033",
    "title": "Authentication Service",
    "content": "# Authentication Service\n\n\n\n```\nnpm install @feathersjs/authentication --save\n```\n\nThe `AuthenticationService` is a [Feathers service](../services.md) that allows to register different [authentication strategies](./strategy.md) and manage access tokens (using [JSON web tokens (JWT)](https://jwt.io/) by default). This section describes\n\n- The [standard setup](#setup) used by the generator\n- How to [configure](#configuration) authentication and where the configuration should go\n- The different [authentication flows](#authentication-flows)\n- The methods available on the authentication service\n- How to [customize](#customization) the authentication service\n- The [Events](#events) sent by the authentication service\n\n## Setup\n\nThe standard setup initializes an [AuthenticationService](#authenticationservice) at the `/authentication` path with a [JWT strategy](./jwt.md), [Local strategy](./local.md) and [OAuth authentication](./oauth.md) (if selected).\n\n```ts\nimport { AuthenticationService, JWTStrategy } from '@feathersjs/authentication'\nimport { LocalStrategy } from '@feathersjs/authentication-local'\nimport type { Application } from './declarations'\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    authentication: AuthenticationService\n  }\n}\n\nexport const authentication = (app: Application) => {\n  const authentication = new AuthenticationService(app)\n\n  authentication.register('jwt', new JWTStrategy())\n  authentication.register('local', new LocalStrategy())\n\n  app.use('authentication', authentication)\n}\n```\n\n## Configuration\n\nThe standard authentication service configuration is normally located in the `authentication` section of a [configuration file](../configuration.md) (default: `config/default.json`).\n\n\n\nThe following options are available:\n\n- `secret`: The JWT signing secret.\n- `service`: The path of the entity service\n- `authStrategies`: A list of authentication strategy names to allow on this authentication service to create access tokens.\n- `parseStrategies`: A list of authentication strategies that should be used to parse HTTP requests. Defaults to the same as `authStrategies`.\n- `entity`: The name of the field that will contain the entity after successful authentication. Will also be used to set `params[entity]` (usually `params.user`) when using the [authenticate hook](./hook). Can be `null` if no entity is used (see [stateless tokens](../../cookbook/authentication/stateless.md)).\n- `entityId`: The id property of an entity object. Only necessary if the entity service does not have an `id` property (e.g. when using a custom entity service).\n- `jwtOptions`: All options available for the [node-jsonwebtoken package](https://github.com/auth0/node-jsonwebtoken).\n\nAn authentication service configuration in `config/default.json` can look like this:\n\n```json\n{\n  \"authentication\": {\n    \"secret\": \"CHANGE_ME\",\n    \"entity\": \"user\",\n    \"service\": \"users\",\n    \"authStrategies\": [\"jwt\", \"local\"],\n    \"jwtOptions\": {\n      \"header\": { \"typ\": \"access\" },\n      \"audience\": \"https://yourdomain.com\",\n      \"issuer\": \"feathers\",\n      \"algorithm\": \"HS256\",\n      \"expiresIn\": \"1d\"\n    }\n  }\n}\n```\n\n\n\nAdditionally to the above configuration, most [strategies](./strategy.md) will look for their own configuration under the name it was registered. An example can be found in the [local strategy configuration](./local.md#configuration).\n\n## Authentication flows\n\nBelow are the flows how the authentication service can be used.\n\n### To _create a new JWT_\n\nFor any strategy allowed in `authStrategies`, a user can call `app.service('/authentication').create(data)` or `POST /authentication` with `data` as `{ strategy: name, ...loginData }`. Internally authentication will then\n\n- Call the strategy `.authenticate` method with `data`\n- Create a JWT for the entity returned by the strategy\n- Return the JWT (`accessToken`) and the additional information from the strategy\n\nFor `local` strategy, the user has to be created before doing auth, otherwi\n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "authentication",
      "service",
      "npm",
      "install",
      "feathersjs",
      "save",
      "authenticationservice",
      "feathers",
      "services",
      "md",
      "allows",
      "register",
      "different",
      "strategies",
      "strategy",
      "manage",
      "access",
      "tokens",
      "using",
      "json",
      "web",
      "jwt",
      "https",
      "io",
      "default",
      "section",
      "describes",
      "standard",
      "setup",
      "used",
      "generator",
      "configure",
      "configuration",
      "go",
      "flows",
      "methods",
      "available",
      "customize",
      "customization",
      "events",
      "sent",
      "initializes",
      "path",
      "local",
      "oauth",
      "if",
      "selected",
      "ts",
      "import",
      "jwtstrategy",
      "localstrategy",
      "type",
      "application",
      "declarations",
      "declare",
      "module",
      "interface",
      "servicetypes",
      "export",
      "const",
      "app",
      "new",
      "use",
      "normally",
      "located",
      "file",
      "config",
      "following",
      "options",
      "secret",
      "signing",
      "entity",
      "authstrategies",
      "list",
      "names",
      "allow",
      "create",
      "parsestrategies",
      "parse",
      "http",
      "requests",
      "defaults",
      "name",
      "field",
      "contain",
      "successful",
      "also",
      "set",
      "params",
      "usually",
      "user",
      "authenticate",
      "hook",
      "null",
      "see",
      "stateless",
      "cookbook",
      "entityid",
      "id",
      "property",
      "object",
      "necessary",
      "custom",
      "jwtoptions",
      "node",
      "jsonwebtoken",
      "package",
      "github",
      "com",
      "auth0",
      "look",
      "like",
      "change",
      "users",
      "header",
      "typ",
      "audience",
      "yourdomain",
      "issuer",
      "algorithm",
      "hs256",
      "expiresin",
      "1d",
      "additionally",
      "registered",
      "example",
      "found",
      "allowed",
      "call",
      "data",
      "post",
      "logindata",
      "internally",
      "method",
      "returned",
      "return",
      "accesstoken",
      "additional",
      "information",
      "created",
      "doing",
      "auth",
      "otherwi",
      "content",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "authentication",
    "source": {
      "path": "api/authentication/service.md"
    },
    "tags": [
      "authentication",
      "service",
      "jwt",
      "create",
      "accesstoken"
    ]
  },
  {
    "id": "v5-doc-034",
    "title": "JWT Strategy",
    "content": "# JWT Authentication\n\n\n\n```\nnpm install @feathersjs/authentication --save\n```\n\nThe `JWTStrategy` is an [authentication strategy](./strategy.md) included in `@feathersjs/authentication` for authenticating [JSON web tokens (JWT)](https://jwt.io/):\n\n```json\n{\n  \"strategy\": \"jwt\",\n  \"accessToken\": \"<your JWT>\"\n}\n```\n\n## Usage\n\n```ts\nimport { AuthenticationService, JWTStrategy } from '@feathersjs/authentication'\nimport type { Application } from './declarations'\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    authentication: AuthenticationService\n  }\n}\n\nexport const authentication = (app: Application) => {\n  const authentication = new AuthenticationService(app)\n\n  authentication.register('jwt', new JWTStrategy())\n\n  app.use('authentication', authentication)\n}\n```\n\n## Options\n\nOptions are set in the [authentication configuration](./service.md#configuration) under the strategy name. Available options are:\n\n- `header` (default: `'Authorization'`): The HTTP header containing the JWT\n- `schemes` (default: `[ 'Bearer', 'JWT' ]`): An array of schemes to support\n\nThe default settings support passing the JWT through the following HTTP headers:\n\n```\nAuthorization: <your JWT>\nAuthorization: Bearer <your JWT>\nAuthorization: JWT <your JWT>\n```\n\nOptions are usually set under the registered name via [Feathers configuration](../configuration.md) in `config/default.json` or `config/<environment>.json`:\n\n```json\n{\n  \"authentication\": {\n    \"jwt\": {\n      \"header\": \"X-Auth\"\n    }\n  }\n}\n```\n\n\n\nTo change the settings for generating and validating a JWT see the [authentication service configuration](./service.md#configuration)\n\n## JwtStrategy\n\n### getEntity(id, params)\n\n`jwtStrategy.getEntity(id, params)` returns the entity instance for `id`, usually `entityService.get(id, params)`. It will _not_ be called if `entity` in the [authentication configuration](./service.md#configuration) is set to `null`.\n\n### authenticate(data, params)\n\n`jwtStrategy.authenticate(data, params)` will try to verify `data.accessToken` by calling the strategies [authenticationService.verifyAccessToken](./service.md).\n\nReturns a promise that resolves with the following format:\n\n```js\n{\n  [entity],\n  accessToken,\n  authentication: {\n    strategy: 'jwt',\n    payload\n  }\n}\n```\n\n\n\n### getEntityQuery(params)\n\nReturns the `query` to use when calling `entityService.get` (default: `{}`).\n\n### parse(req, res)\n\nParse the HTTP request headers for JWT authentication information. By default in the `Authorization` header. Returns a promise that resolves with either `null` or data in the form of:\n\n```js\n{\n  strategy: '<strategy name>',\n  accessToken: '<access token from HTTP header>'\n}\n```\n\n## Customization\n\n```ts\nimport { AuthenticationService, JWTStrategy } from '@feathersjs/authentication'\nimport { LocalStrategy } from '@feathersjs/authentication-local'\nimport type { Application } from './declarations'\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    authentication: AuthenticationService\n  }\n}\n\nclass MyJwtStrategy extends JWTStrategy {\n  // Only allow authenticating activated users\n  async getEntityQuery(params: Params) {\n    return {\n      active: true\n    }\n  }\n}\n\nexport default (app: Application) => {\n  const authentication = new AuthenticationService(app)\n\n  authentication.register('jwt', new MyJwtStrategy())\n\n  // ...\n  app.use('authentication', authentication)\n}\n```",
    "version": "v5",
    "tokens": [
      "jwt",
      "strategy",
      "authentication",
      "npm",
      "install",
      "feathersjs",
      "save",
      "jwtstrategy",
      "md",
      "included",
      "authenticating",
      "json",
      "web",
      "tokens",
      "https",
      "io",
      "accesstoken",
      "usage",
      "ts",
      "import",
      "authenticationservice",
      "type",
      "application",
      "declarations",
      "declare",
      "module",
      "interface",
      "servicetypes",
      "export",
      "const",
      "app",
      "new",
      "register",
      "use",
      "options",
      "set",
      "configuration",
      "service",
      "name",
      "available",
      "header",
      "default",
      "authorization",
      "http",
      "containing",
      "schemes",
      "bearer",
      "array",
      "support",
      "settings",
      "passing",
      "following",
      "headers",
      "usually",
      "registered",
      "via",
      "feathers",
      "config",
      "environment",
      "auth",
      "change",
      "generating",
      "validating",
      "see",
      "getentity",
      "id",
      "params",
      "returns",
      "entity",
      "instance",
      "entityservice",
      "get",
      "called",
      "if",
      "null",
      "authenticate",
      "data",
      "try",
      "verify",
      "calling",
      "strategies",
      "verifyaccesstoken",
      "promise",
      "resolves",
      "format",
      "js",
      "payload",
      "getentityquery",
      "query",
      "parse",
      "req",
      "res",
      "request",
      "information",
      "form",
      "access",
      "token",
      "customization",
      "localstrategy",
      "local",
      "class",
      "myjwtstrategy",
      "extends",
      "allow",
      "activated",
      "users",
      "async",
      "return",
      "active",
      "true"
    ],
    "category": "authentication",
    "source": {
      "path": "api/authentication/jwt.md"
    },
    "tags": [
      "jwt",
      "jsonwebtoken",
      "strategy",
      "bearer",
      "token"
    ]
  },
  {
    "id": "v5-doc-035",
    "title": "Local Strategy",
    "content": "# Local Authentication\n\n\n\n```\nnpm install @feathersjs/authentication-local --save\n```\n\n`@feathersjs/authentication-local` provides a `LocalStrategy` for authenticating with a username/email and password combination, e.g.\n\n```json\n{\n  \"strategy\": \"local\",\n  \"email\": \"hello@feathersjs.com\",\n  \"password\": \"supersecret\"\n}\n```\n\n## Usage\n\n```ts\nimport { AuthenticationService } from '@feathersjs/authentication'\nimport { LocalStrategy } from '@feathersjs/authentication-local'\nimport type { Application } from './declarations'\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    authentication: AuthenticationService\n  }\n}\n\nexport const authentication = (app: Application) => {\n  const authentication = new AuthenticationService(app)\n\n  authentication.register('local', new LocalStrategy())\n\n  app.use('authentication', authentication)\n}\n```\n\n## Options\n\nOptions are set in the [authentication configuration](./service.md#configuration) under the strategy name. Available options are:\n\n- `usernameField`: Name of the username field (e.g. `'email'`), may be a nested property (e.g. `'auth.email'`)\n- `passwordField`: Name of the password field (e.g. `'password'`), may be a nested property (e.g. `'auth.password'`)\n- `hashSize` (default: `10`): The BCrypt salt length\n- `errorMessage` (default: `'Invalid login'`): The error message to return on errors\n- `entityUsernameField` (default: `usernameField`): Name of the username field on the entity if authentication request data and entity field names are different\n- `entityPasswordField` (default: `passwordField`): Name of the password field on the entity if authentication request data and entity field names are different\n\nOptions are usually set under the registered name via [Feathers configuration](../configuration.md) in `config/default.json` or `config/<environment>.json`:\n\n```json\n{\n  \"authentication\": {\n    \"local\": {\n      \"usernameField\": \"email\",\n      \"passwordField\": \"password\"\n    }\n  }\n}\n```\n\n## LocalStrategy\n\n\n\n### getEntityQuery(query, params)\n\n`localStrategy.getEntityQuery(query, params) -> Promise` returns the query for finding the entity. `query` includes the `usernameField` or `entityUsernameField` as `{ [field]: username }` and by default returns a promise that resolves with `{ $limit: 1 }` combined with `query`.\n\n### findEntity(username, params)\n\n`localStrategy.findEntity(username, params) -> Promise` return the entity for a given username and service call parameters. It will use the query returned by `getEntityQuery` and call `.find` on the entity (usually `/users`) service. It will return a promise that resolves with the first result of the `.find` call or throw an error if nothing was found.\n\n### getEntity(entity, params)\n\n`localStrategy.getEntity(authResult, params) -> Promise` returns the external representation for `entity` that will be sent back to the client.\n\n### hashPassword(password)\n\n`localStrategy.hashPassword(password) -> Promise` creates a safe one-way hash of the given plain `password` string. By default [bCryptJS](https://www.npmjs.com/package/bcryptjs) is used.\n\n### comparePassword(entity, password)\n\n`localStrategy.comparePassword(entity, password) -> Promise` compares a plain text `password` with the hashed password of the `entity` returned by `findEntity`. Returns the `entity` or throws an error if the passwords don't match.\n\n### authenticate(authentication, params)\n\n`localStrategy.authenticate(authentication, params)` is the main endpoint implemented by any [authentication strategy](./strategy.md). It is usually called for authentication requests for this strategy by the [AuthenticationService](./service.md).\n\n## Customization\n\nThe `LocalStrategy` can be customized like any ES6 class and then registered on the [AuthenticationService](./service.md):\n\n```ts\nimport type { Application, Params, Query } from '@feathersjs/feathers'\nimport { AuthenticationService, JWTStrategy } from '@feathersjs/authentication'\nimport { LocalStrategy } from '@feathersjs/authen\n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "local",
      "strategy",
      "authentication",
      "npm",
      "install",
      "feathersjs",
      "save",
      "provides",
      "localstrategy",
      "authenticating",
      "username",
      "email",
      "password",
      "combination",
      "json",
      "hello",
      "com",
      "supersecret",
      "usage",
      "ts",
      "import",
      "authenticationservice",
      "type",
      "application",
      "declarations",
      "declare",
      "module",
      "interface",
      "servicetypes",
      "export",
      "const",
      "app",
      "new",
      "register",
      "use",
      "options",
      "set",
      "configuration",
      "service",
      "md",
      "name",
      "available",
      "usernamefield",
      "field",
      "nested",
      "property",
      "auth",
      "passwordfield",
      "hashsize",
      "default",
      "10",
      "bcrypt",
      "salt",
      "length",
      "errormessage",
      "invalid",
      "login",
      "error",
      "message",
      "return",
      "errors",
      "entityusernamefield",
      "entity",
      "if",
      "request",
      "data",
      "names",
      "different",
      "entitypasswordfield",
      "usually",
      "registered",
      "via",
      "feathers",
      "config",
      "environment",
      "getentityquery",
      "query",
      "params",
      "promise",
      "returns",
      "finding",
      "includes",
      "resolves",
      "limit",
      "combined",
      "findentity",
      "given",
      "call",
      "parameters",
      "returned",
      "find",
      "users",
      "first",
      "result",
      "throw",
      "nothing",
      "found",
      "getentity",
      "authresult",
      "external",
      "representation",
      "sent",
      "back",
      "client",
      "hashpassword",
      "creates",
      "safe",
      "one",
      "way",
      "hash",
      "plain",
      "string",
      "bcryptjs",
      "https",
      "www",
      "npmjs",
      "package",
      "used",
      "comparepassword",
      "compares",
      "text",
      "hashed",
      "throws",
      "passwords",
      "don",
      "match",
      "authenticate",
      "main",
      "endpoint",
      "implemented",
      "called",
      "requests",
      "customization",
      "customized",
      "like",
      "es6",
      "class",
      "jwtstrategy",
      "authen",
      "content",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "authentication",
    "source": {
      "path": "api/authentication/local.md"
    },
    "tags": [
      "local",
      "password",
      "username",
      "bcrypt",
      "strategy"
    ]
  },
  {
    "id": "v5-doc-036",
    "title": "OAuth Strategy",
    "content": "# OAuth\n\n\n\n```\nnpm install @feathersjs/authentication-oauth --save\n```\n\n`@feathersjs/authentication-oauth` allows to authenticate with over 180 OAuth providers (Google, Facebook, GitHub etc.) using [grant](https://github.com/simov/grant), an OAuth middleware module for NodeJS.\n\n## Usage\n\nThe following section covers oAuth authentication strategy [setup](#setup) and a more detailed description of the possible oAuth [flows](#flow) and [oAuth URLs](#oauth-urls).\n\n### Setup\n\nThe following is a standard oAuth setup. The `OAuthStrategy` often needs to be [customized](#customization) to include additional fields (like the avatar, email address or username) from the oAuth provider.\n\n```ts\nimport { AuthenticationService, JWTStrategy } from '@feathersjs/authentication'\nimport { LocalStrategy } from '@feathersjs/authentication-local'\nimport { OAuthStrategy, oauth } from '@feathersjs/authentication-oauth'\nimport type { Application } from './declarations'\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    authentication: AuthenticationService\n  }\n}\n\nexport const authentication = (app: Application) => {\n  const authentication = new AuthenticationService(app)\n\n  authentication.register('jwt', new JWTStrategy())\n  authentication.register('github', new OAuthStrategy())\n  authentication.register('google', new OAuthStrategy())\n\n  app.use('authentication', authentication)\n  app.configure(oauth({}))\n}\n```\n\nThe following settings for `app.configure(oauth())` are available:\n\n- `linkStrategy` (default: `'jwt'`) - The name of the stratagy to use for [account linking](#account-linking)\n- `authService` (default: `app.get('defaultAuthentication')`) - The path of the authentication service to use\n- `expressSession` - An Express middleware for handling sessions. By default will use an HTTP cookie that is only available for the oAuth flow. **This normally does not need to be changed.**\n- `koaSession` - A Koa middleware for handling sessions. By default will use an HTTP cookie that is only available for the oAuth flow. **This normally does not need to be changed.**\n\n### Providers\n\nFor specific OAuth provider setup see the following [cookbook](../../cookbook/) guides:\n\n- [Auth0](../../cookbook/authentication/auth0.md)\n- [Facebook](../../cookbook/authentication/facebook.md)\n- [Google](../../cookbook/authentication/google.md)\n\n### Flow\n\nThere are two ways to initiate OAuth authentication:\n\n1. Through the browser (most common)\n\n   - User clicks on link to OAuth URL (`oauth/<provider>`)\n   - Gets redirected to provider and authorizes the application\n   - Callback to the [OauthStrategy](#oauthstrategy) which\n     - Gets the users profile\n     - Finds or creates the user (entity) for that profile\n   - The [AuthenticationService](./service.md) creates an access token for that entity\n   - Redirects back to the origin URL including the generated access token\n   - The frontend (e.g. the Feathers [authentication client](./client.md)) uses the returned access token to authenticate\n\n2. With an existing access token, e.g. obtained through the Facebook mobile SDK\n   - Authenticate normally through the [authentication service](./service.md) with `{ strategy: '<name>', accessToken: 'oauth access token' }`.\n   - Calls the [OauthStrategy](#oauthstrategy) which\n     - Gets the users profile\n     - Finds or creates the entity for that profile\n   - Returns the authentication result\n\n\n\n### OAuth URLs\n\nThere are two URLs and redirects that are important for OAuth authentication:\n\n- `http(s)://<host>/oauth/<provider>`: The main URL to initiate the OAuth flow. **Link to this from the browser.**\n- `http(s)://<host>/oauth/<provider>/callback`: The callback path that should be **set in the OAuth provider application settings.**\n\nIn the browser any OAuth flow can be initiated with a link like this:\n\n```html\n<a href=\"/oauth/github\">Login with GitHub</a>\n```\n\n### Account linking\n\nTo **link an existing user** the current access token can be added to the OAuth flow query using \n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "oauth",
      "strategy",
      "npm",
      "install",
      "feathersjs",
      "authentication",
      "save",
      "allows",
      "authenticate",
      "180",
      "providers",
      "google",
      "facebook",
      "github",
      "etc",
      "using",
      "grant",
      "https",
      "com",
      "simov",
      "middleware",
      "module",
      "nodejs",
      "usage",
      "following",
      "section",
      "covers",
      "setup",
      "detailed",
      "description",
      "possible",
      "flows",
      "flow",
      "urls",
      "standard",
      "oauthstrategy",
      "often",
      "needs",
      "customized",
      "customization",
      "include",
      "additional",
      "fields",
      "like",
      "avatar",
      "email",
      "address",
      "username",
      "provider",
      "ts",
      "import",
      "authenticationservice",
      "jwtstrategy",
      "localstrategy",
      "local",
      "type",
      "application",
      "declarations",
      "declare",
      "interface",
      "servicetypes",
      "export",
      "const",
      "app",
      "new",
      "register",
      "jwt",
      "use",
      "configure",
      "settings",
      "available",
      "linkstrategy",
      "default",
      "name",
      "stratagy",
      "account",
      "linking",
      "authservice",
      "get",
      "defaultauthentication",
      "path",
      "service",
      "expresssession",
      "express",
      "handling",
      "sessions",
      "http",
      "cookie",
      "normally",
      "need",
      "changed",
      "koasession",
      "koa",
      "specific",
      "see",
      "cookbook",
      "guides",
      "auth0",
      "md",
      "two",
      "ways",
      "initiate",
      "browser",
      "common",
      "user",
      "clicks",
      "link",
      "url",
      "gets",
      "redirected",
      "authorizes",
      "callback",
      "users",
      "profile",
      "finds",
      "creates",
      "entity",
      "access",
      "token",
      "redirects",
      "back",
      "origin",
      "including",
      "generated",
      "frontend",
      "feathers",
      "client",
      "uses",
      "returned",
      "existing",
      "obtained",
      "mobile",
      "sdk",
      "accesstoken",
      "calls",
      "returns",
      "result",
      "important",
      "host",
      "main",
      "set",
      "initiated",
      "html",
      "href",
      "login",
      "current",
      "added",
      "query",
      "content",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "authentication",
    "source": {
      "path": "api/authentication/oauth.md"
    },
    "tags": [
      "oauth",
      "google",
      "github",
      "facebook",
      "strategy",
      "social"
    ]
  },
  {
    "id": "v5-doc-037",
    "title": "Authentication Hook",
    "content": "# Authenticate Hook\n\nThe `authenticate` hook will use `params.authentication` of the service method call and run [authenticationService.authenticate()](./service.md#authenticate-data-params-strategies).\n\nThe hook will\n\n- Throw an error if the strategy fails\n- Throw an error if no authentication information is set and it is an external call (`params.provider` is set) or do nothing if it is an internal call (`params.provider` is `undefined`)\n- If successful, merge `params` with the return value of the authentication strategy\n\nFor example, a successful [JWT strategy](./jwt.md) authentication will set:\n\n```js\nparams.authentication.payload // The decoded payload\nparams.authentication.strategy === 'jwt' // The strategy name\nparams.user // or params[entity] if entity is not `null`\n```\n\nIn the following hooks and for the service method call. It can be used as a `before` or `around` [hook](../hooks.md).\n\n## authenticate(...strategies)\n\nCheck `params.authentication` against a list of authentication strategy names.\n\n```ts\nimport { authenticate } from '@feathersjs/authentication'\n\n// Authenticate with `jwt` and `api-key` strategy\n// using app.service('authentication') as the authentication service\napp.service('messages').hooks({\n  around: {\n    all: [authenticate('jwt', 'api-key')]\n  }\n})\n```\n\n## authenticate(options)\n\nCheck `params.authentication` against a list of strategies and specific authentication service. Available `options` are:\n\n- `service` - The path to the authentication service\n- `strategies` - A list of strategy names\n\n```js\nimport { authenticate } from '@feathersjs/authentication'\n\n// Authenticate with `jwt` and `api-key` strategy\n// using app.service('v1/authentication') as the authentication service\napp.service('messages').hooks({\n  before: {\n    all: [\n      authenticate({\n        service: 'v1/authentication',\n        strategies: ['jwt', 'api-key']\n      })\n    ]\n  }\n})\n```",
    "version": "v5",
    "tokens": [
      "authentication",
      "hook",
      "authenticate",
      "use",
      "params",
      "service",
      "method",
      "call",
      "run",
      "authenticationservice",
      "md",
      "data",
      "strategies",
      "throw",
      "error",
      "if",
      "strategy",
      "fails",
      "information",
      "set",
      "external",
      "provider",
      "nothing",
      "internal",
      "undefined",
      "successful",
      "merge",
      "return",
      "value",
      "example",
      "jwt",
      "js",
      "payload",
      "decoded",
      "name",
      "user",
      "entity",
      "null",
      "following",
      "hooks",
      "used",
      "around",
      "check",
      "list",
      "names",
      "ts",
      "import",
      "feathersjs",
      "api",
      "key",
      "using",
      "app",
      "messages",
      "options",
      "specific",
      "available",
      "path",
      "v1"
    ],
    "category": "authentication",
    "source": {
      "path": "api/authentication/hook.md"
    },
    "tags": [
      "authenticate",
      "hook",
      "protect",
      "authorization"
    ]
  },
  {
    "id": "v5-doc-038",
    "title": "Authentication Client",
    "content": "# Authentication Client\n\n\n\n```\nnpm install @feathersjs/authentication-client --save\n```\n\nThe `@feathersjs/authentication-client` module allows you to easily authenticate a Feathers client against a Feathers server. It is not required, but makes it easier to implement authentication in your client by automatically storing and sending the access token and handling re-authenticating when a websocket disconnects.\n\n## Usage\n\n```ts\nimport { feathers } from '@feathersjs/feathers'\nimport socketio from '@feathersjs/socketio-client'\nimport io from 'socket.io-client'\nimport authentication from '@feathersjs/authentication-client'\n\nconst socket = io('http://api.feathersjs.com')\nconst app = feathers()\n\n// Setup the transport (Rest, Socket, etc.) here\napp.configure(socketio(socket))\n\n// Available options are listed in the \"Options\" section\napp.configure(authentication())\n```\n\n## Options\n\nThe following options are available for `app.configure(authentication(options))`:\n\n- `storage` (default: `localStorage` if available, `MemoryStorage` otherwise) - The storage to store the access token. For React Native use `import { AsyncStorage } from 'react-native'`\n- `path` (default: '/authentication') - The path of the authentication service\n- `locationKey` (default: `'access_token'`) - The name of the window hash parameter to parse for an access token from the `window.location`. Usually used by the OAuth flow.\n- `locationErrorKey` (default: `'error') - The name of the window hash parameter to parse for authentication errors. Usually used by the OAuth flow.\n- `jwtStrategy` (default: `'jwt'`) - The access token authentication strategy\n- `storageKey` (default: `'feathers-jwt'`) - Key for storing the token in `storage`\n- `header` (default: `'Authorization'`) - Name of the accessToken header\n- `scheme` (default: `'Bearer'`) - The HTTP header scheme\n- Authentication (default: `AuthenticationClient`) - Allows to provide a [customized authentication client class](#customization)\n\n\n\n## app.reAuthenticate([force])\n\n`app.reAuthenticate() -> Promise` will try to authenticate using the access token from the storage or the window location (e.g. after a successful [OAuth](./oauth.md) login). This is normally called to either show your application (when successful) or showing a login page or redirecting to the appropriate OAuth link.\n\n```js\ntry {\n  await app.reAuthenticate()\n  showDashboard()\n} catch (error) {\n  showLoginPage()\n}\n```\n\n\n\nIn some rare cases, for example making sure the user object returned by `app.get('authentication')` is up-to-date after it was changed on the server, you may force reauthentication via `app.reAuthenticate(true)`.\n\n## app.authenticate(data)\n\n`app.authenticate(data) -> Promise` will try to authenticate with a Feathers server by passing a `strategy` and other properties as credentials.\n\n```ts\ntry {\n  // Authenticate with the local email/password strategy\n  await app.authenticate({\n    strategy: 'local',\n    email: 'my@email.com',\n    password: 'my-password'\n  })\n  // Show e.g. logged in dashboard page\n} catch (error: any) {\n  // Show login page (potentially with `e.message`)\n  console.error('Authentication error', e)\n}\n```\n\n- `data {Object}` - of the format `{strategy [, ...otherProps]}`\n  - `strategy {String}` - the name of the strategy to be used to authenticate. Required.\n  - `...otherProps {Properties} ` vary depending on the chosen strategy. Above is an example of using the `local` strategy.\n\n## app.logout()\n\nRemoves the access token from storage on the client. It also calls the `remove` method of the [authentication service](./service.md).\n\n## app.get('authentication')\n\n`app.get('authentication') -> Promise` is a Promise that resolves with the current authentication information. For most strategies this is the best place to **get the currently authenticated user**:\n\n```js\n// Returns the authenticated user\nconst { user } = await app.get('authentication')\n// Gets the authenticated accessToken (JWT)\nconst { accessToken } = await app.get\n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "authentication",
      "client",
      "npm",
      "install",
      "feathersjs",
      "save",
      "module",
      "allows",
      "easily",
      "authenticate",
      "feathers",
      "server",
      "required",
      "makes",
      "easier",
      "implement",
      "automatically",
      "storing",
      "sending",
      "access",
      "token",
      "handling",
      "re",
      "authenticating",
      "websocket",
      "disconnects",
      "usage",
      "ts",
      "import",
      "socketio",
      "io",
      "socket",
      "const",
      "http",
      "api",
      "com",
      "app",
      "setup",
      "transport",
      "rest",
      "etc",
      "configure",
      "available",
      "options",
      "listed",
      "section",
      "following",
      "storage",
      "default",
      "localstorage",
      "if",
      "memorystorage",
      "otherwise",
      "store",
      "react",
      "native",
      "use",
      "asyncstorage",
      "path",
      "service",
      "locationkey",
      "name",
      "window",
      "hash",
      "parameter",
      "parse",
      "location",
      "usually",
      "used",
      "oauth",
      "flow",
      "locationerrorkey",
      "error",
      "errors",
      "jwtstrategy",
      "jwt",
      "strategy",
      "storagekey",
      "key",
      "header",
      "authorization",
      "accesstoken",
      "scheme",
      "bearer",
      "authenticationclient",
      "provide",
      "customized",
      "class",
      "customization",
      "reauthenticate",
      "force",
      "promise",
      "try",
      "using",
      "successful",
      "md",
      "login",
      "normally",
      "called",
      "show",
      "application",
      "showing",
      "page",
      "redirecting",
      "appropriate",
      "link",
      "js",
      "await",
      "showdashboard",
      "catch",
      "showloginpage",
      "rare",
      "cases",
      "example",
      "making",
      "sure",
      "user",
      "object",
      "returned",
      "get",
      "date",
      "changed",
      "reauthentication",
      "via",
      "true",
      "data",
      "passing",
      "properties",
      "credentials",
      "local",
      "email",
      "password",
      "logged",
      "dashboard",
      "potentially",
      "message",
      "console",
      "format",
      "otherprops",
      "string",
      "vary",
      "depending",
      "chosen",
      "logout",
      "removes",
      "also",
      "calls",
      "remove",
      "method",
      "resolves",
      "current",
      "information",
      "strategies",
      "best",
      "place",
      "currently",
      "authenticated",
      "returns",
      "gets",
      "content",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "authentication",
    "source": {
      "path": "api/authentication/client.md"
    },
    "tags": [
      "authentication",
      "client",
      "login",
      "logout",
      "reAuthenticate"
    ]
  },
  {
    "id": "v5-doc-039",
    "title": "Authentication Base Strategy",
    "content": "# Authentication Strategies\n\nAn authentication strategy is any object or class that implements at least an [authenticate(data, params)]() method. They can be registered with the AuthenticationService to authenticate service calls and other requests. The following strategies already come with Feathers:\n\n- [JWTStrategy](./jwt.md) in `@feathersjs/authentication`\n- [LocalStrategy](./local.md) in `@feathersjs/authentication-local`\n- [OAuthStrategy](./oauth.md) in `@feathersjs/authentication-oauth`\n\nMore details on how to customize existing strategies can be found in their API documentation. This section describes the common methods for all authentication strategies and how a custom authentication strategy can be implemented.\n\n## setName(name)\n\nWill be called with the `name` under which the strategy has been [registered on the authentication service](./service.md#register-name-strategy). Does not have to be implemented.\n\n## setApplication(app)\n\nWill be called with the [Feathers application](../application.md) instance. Does not have to be implemented.\n\n## setAuthentication(service)\n\nWill be called with the [Authentication service](./service.md) this strategy has been registered on. Does not have to be implemented.\n\n## verifyConfiguration()\n\nSynchronously verify the configuration for this strategy and throw an error if e.g. required fields are not set. Does not have to be implemented.\n\n## authenticate(authentication, params)\n\nAuthenticate `authentication` data with additional `params`. `authenticate` should throw a `NotAuthenticated` if it failed or return an authentication result object.\n\n## parse(req, res)\n\nParse a given plain Node HTTP request and response and return `null` or the authentication information it provides. Does not have to be implemented.\n\nThis is called by the authentication service. See [AuthService.parse](https://dove.feathersjs.com/api/authentication/service.html#parse-req-res-strategies)\n\n## AuthenticationBaseStrategy\n\nThe `AuthenticationBaseStrategy` class provides a base class that already implements some of the strategy methods below with some common functionality:\n\n- [setName](#setname-name) sets `this.name`\n- [setApplication](#setapplication-app) sets `this.app`\n- [setAuthentication](#setauthentication-service) sets `this.authentication`\n- `configuration` getter returns `this.authentication.configuration[this.name]`\n- `entityService` getter returns the entity (usually `/users`) service from `this.app`\n\n## Examples\n\nExamples for authentication strategies can be found in the [Cookbook](../../cookbook/):\n\n- [Anonymous strategy](../../cookbook/authentication/anonymous.md)",
    "version": "v5",
    "tokens": [
      "authentication",
      "base",
      "strategy",
      "strategies",
      "object",
      "class",
      "implements",
      "least",
      "authenticate",
      "data",
      "params",
      "method",
      "registered",
      "authenticationservice",
      "service",
      "calls",
      "requests",
      "following",
      "already",
      "come",
      "feathers",
      "jwtstrategy",
      "jwt",
      "md",
      "feathersjs",
      "localstrategy",
      "local",
      "oauthstrategy",
      "oauth",
      "details",
      "customize",
      "existing",
      "found",
      "api",
      "documentation",
      "section",
      "describes",
      "common",
      "methods",
      "custom",
      "implemented",
      "setname",
      "name",
      "called",
      "register",
      "setapplication",
      "app",
      "application",
      "instance",
      "setauthentication",
      "verifyconfiguration",
      "synchronously",
      "verify",
      "configuration",
      "throw",
      "error",
      "if",
      "required",
      "fields",
      "set",
      "additional",
      "notauthenticated",
      "failed",
      "return",
      "result",
      "parse",
      "req",
      "res",
      "given",
      "plain",
      "node",
      "http",
      "request",
      "response",
      "null",
      "information",
      "provides",
      "see",
      "authservice",
      "https",
      "dove",
      "com",
      "html",
      "authenticationbasestrategy",
      "functionality",
      "sets",
      "getter",
      "returns",
      "entityservice",
      "entity",
      "usually",
      "users",
      "examples",
      "cookbook",
      "anonymous"
    ],
    "category": "authentication",
    "source": {
      "path": "api/authentication/strategy.md"
    },
    "tags": [
      "strategy",
      "base",
      "custom",
      "authenticate",
      "parse"
    ]
  },
  {
    "id": "v5-doc-040",
    "title": "Anonymous Authentication",
    "content": "# Anonymous authentication\n\nAnonymous authentication can be allowed by creating a [custom strategy](../../api/authentication/strategy.md) that returns the `params` that you would like to use to identify an authenticated user.\n\n\n\n<LanguageBlock global-id=\"ts\">\n\n```ts\nimport { Params } from '@feathersjs/feathers';\nimport { AuthenticationBaseStrategy, AuthenticationResult, AuthenticationService } from '@feathersjs/authentication';\n\nclass AnonymousStrategy extends AuthenticationBaseStrategy {\n  async authenticate(authentication: AuthenticationResult, params: Params) {\n    return {\n      anonymous: true\n    }\n  }\n}\n\nexport default function(app: Application) {\n  const authentication = new AuthenticationService(app);\n  // ... authentication service setup\n  authentication.register('anonymous', new AnonymousStrategy());\n}\n```\n\n</LanguageBlock>\n\n<LanguageBlock global-id=\"js\">\n\nIn `src/authentication.js`:\n\n```js\nconst { AuthenticationBaseStrategy, AuthenticationService } = require('@feathersjs/authentication');\n\nclass AnonymousStrategy extends AuthenticationBaseStrategy {\n  async authenticate(authentication, params) {\n    return {\n      anonymous: true\n    }\n  }\n}\n\nmodule.exports = app => {\n  const authentication = new AuthenticationService(app);\n  // ... authentication service setup\n  authentication.register('anonymous', new AnonymousStrategy());\n}\n```\n\n</LanguageBlock>\n\n\n\n\nNext, we create a hook called `allow-anonymous` that sets `params.authentication` if it does not exist and if `params.provider` exists (which means it is an external call) to use that `anonymous` strategy:\n\n\n\n<LanguageBlock global-id=\"ts\">\n\n```ts\nimport { Hook, HookContext } from '@feathersjs/feathers';\n\nexport default (): Hook => {\n  return async (context: HookContext, next?: NextFunction) => {\n    const { params } = context;\n\n    if (params.provider && !params.authentication) {\n      context.params = {\n        ...params,\n        authentication: {\n          strategy: 'anonymous'\n        }\n      }\n    }\n\n    if (next) {\n      await next();\n    }\n\n    return context;\n  }\n}\n```\n\n</LanguageBlock>\n\n<LanguageBlock global-id=\"js\">\n\n```js\n/* eslint-disable require-atomic-updates */\nmodule.exports = function (options = {}) { // eslint-disable-line no-unused-vars\n  return async context => {\n    const { params } = context;\n\n    if(params.provider && !params.authentication) {\n      context.params = {\n        ...params,\n        authentication: {\n          strategy: 'anonymous'\n        }\n      }\n    }\n\n    return context;\n  };\n};\n```\n\n</LanguageBlock>\n\n\n\nThis hook should be added __before__ the [authenticate hook](../../api/authentication/hook.md) wherever anonymous authentication should be allowed:\n\n```js\nall: [ allowAnonymous(), authenticate('jwt', 'anonymous') ],\n```\n\nIf an anonymous user now accesses the service externally, the service call will succeed and have `params.anonymous` set to `true`.",
    "version": "v5",
    "tokens": [
      "anonymous",
      "authentication",
      "allowed",
      "creating",
      "custom",
      "strategy",
      "api",
      "md",
      "returns",
      "params",
      "like",
      "use",
      "identify",
      "authenticated",
      "user",
      "languageblock",
      "global",
      "id",
      "ts",
      "import",
      "feathersjs",
      "feathers",
      "authenticationbasestrategy",
      "authenticationresult",
      "authenticationservice",
      "class",
      "anonymousstrategy",
      "extends",
      "async",
      "authenticate",
      "return",
      "true",
      "export",
      "default",
      "function",
      "app",
      "application",
      "const",
      "new",
      "service",
      "setup",
      "register",
      "js",
      "src",
      "require",
      "module",
      "exports",
      "next",
      "create",
      "hook",
      "called",
      "allow",
      "sets",
      "if",
      "exist",
      "provider",
      "exists",
      "means",
      "external",
      "call",
      "hookcontext",
      "context",
      "nextfunction",
      "await",
      "eslint",
      "disable",
      "atomic",
      "updates",
      "options",
      "line",
      "unused",
      "vars",
      "added",
      "wherever",
      "allowanonymous",
      "jwt",
      "now",
      "accesses",
      "externally",
      "succeed",
      "set"
    ],
    "category": "authentication",
    "source": {
      "path": "cookbook/authentication/anonymous.md"
    },
    "tags": [
      "cookbook",
      "anonymous",
      "guest"
    ]
  },
  {
    "id": "v5-doc-041",
    "title": "API Key Authentication",
    "content": "# API Key Authentication\n\nWe will start by providing the required configuration for this strategy. You should change all of these values as per your requirement.\n\n```js\n{\n  \"authentication\": {\n    ...otherConfig,\n    \"authStrategies\": [ ...otherStrategies, \"apiKey\" ],\n    \"apiKey\": {\n      \"allowedKeys\": [ \"API_KEY_1\", \"API_KEY_2\" ],\n      \"header\": \"x-access-token\"\n    }\n  }\n}\n```\n\nNote: if all you want is api key authentication, it is still necessary to register a secret, service and entity. Since no other authentication method is used, entity can be `null`.\n\nA fully working example with just API key authentication:\n```json\n{\n  \"host\": \"localhost\",\n  \"port\": 3030,\n  \"public\": \"../public/\",\n  \"paginate\": {\n    \"default\": 10,\n    \"max\": 50\n  },\n  \"authentication\": {\n    \"secret\": \"some-secret\",\n    \"service\": \"users\",\n    \"entity\": null,\n    \"authStrategies\": [\"apiKey\"],\n    \"apiKey\": {\n      \"allowedKeys\": [ \"API_KEY_1\", \"API_KEY_2\" ],\n      \"header\": \"x-access-token\"\n    }\n  }\n}\n```\n\nNext we will be creating a [custom strategy](../../api/authentication/strategy.md) that returns the `params` that you would like to use to identify an authenticated user/request.\n\n\n\n<LanguageBlock global-id=\"ts\">\n\n```ts\nimport { AuthenticationBaseStrategy, AuthenticationResult, AuthenticationService } from '@feathersjs/authentication';\nimport { NotAuthenticated } from '@feathersjs/errors';\nimport { ServiceAddons } from '@feathersjs/feathers';\nimport { Application } from './declarations';\n\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    'authentication': AuthenticationService & ServiceAddons<any>;\n  }\n}\n\nclass ApiKeyStrategy extends AuthenticationBaseStrategy {\n  app: Application;\n\n  constructor(app: Application) {\n    super();\n    this.app = app;\n  }\n\n  async authenticate(authentication: AuthenticationResult) {\n    const { token } = authentication;\n\n    const config = this.app.get('authentication').apiKey;\n\n    const match = config.allowedKeys.includes(token);\n    if (!match) throw new NotAuthenticated('Incorrect API Key');\n\n    return {\n      apiKey: true\n    }\n  }\n}\n\nexport default function (app: Application) {\n  const authentication = new AuthenticationService(app);\n\n  // This can have multiple .register calls if multiple strategies have been added\n  authentication.register('apiKey', new ApiKeyStrategy(app));\n\n  app.use('/authentication', authentication);\n}\n```\n\n</LanguageBlock>\n\n<LanguageBlock global-id=\"js\">\n\nIn `src/authentication.js`:\n\n```js\nconst { AuthenticationBaseStrategy, AuthenticationService } = require('@feathersjs/authentication');\nconst { NotAuthenticated } = require('@feathersjs/errors');\n\nclass ApiKeyStrategy extends AuthenticationBaseStrategy {\n  async authenticate(authentication) {\n    const { token } = authentication;\n\n    const config = this.authentication.configuration[this.name];\n\n    const match = config.allowedKeys.includes(token);\n    if (!match) throw new NotAuthenticated('Incorrect API Key');\n\n    return {\n      apiKey: true\n    }\n  }\n}\n\nmodule.exports = app => {\n  const authentication = new AuthenticationService(app);\n  // ... authentication service setup\n  authentication.register('apiKey', new ApiKeyStrategy());\n}\n```\n\n</LanguageBlock>\n\n\n\nNext, we create a hook called `allow-apiKey` that sets `params.authentication` if it does not exist and if `params.provider` exists (which means it is an external call) to use that `apiKey` strategy. We will also provide the capability for the apiKey to be read from the request header: (you could also read the token as a query parameter but you will have to filter it out before it's passed to Feathers calls like `get` and `find`.\n\n\n\n<LanguageBlock global-id=\"ts\">\n\n```ts\nimport { HookContext, NextFunction } from '@feathersjs/feathers';\n\nexport default () => async (context: HookContext, next: NextFunction) => {\n  const { params, app } = context;\n\n  const headerField = app.get('authentication').apiKey.header;\n  const token = params.headers ? params.headers[headerFi\n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "api",
      "key",
      "authentication",
      "start",
      "providing",
      "required",
      "configuration",
      "strategy",
      "change",
      "values",
      "per",
      "requirement",
      "js",
      "otherconfig",
      "authstrategies",
      "otherstrategies",
      "apikey",
      "allowedkeys",
      "header",
      "access",
      "token",
      "note",
      "if",
      "want",
      "still",
      "necessary",
      "register",
      "secret",
      "service",
      "entity",
      "since",
      "method",
      "used",
      "null",
      "fully",
      "working",
      "example",
      "json",
      "host",
      "localhost",
      "port",
      "3030",
      "public",
      "paginate",
      "default",
      "10",
      "max",
      "50",
      "users",
      "next",
      "creating",
      "custom",
      "md",
      "returns",
      "params",
      "like",
      "use",
      "identify",
      "authenticated",
      "user",
      "request",
      "languageblock",
      "global",
      "id",
      "ts",
      "import",
      "authenticationbasestrategy",
      "authenticationresult",
      "authenticationservice",
      "feathersjs",
      "notauthenticated",
      "errors",
      "serviceaddons",
      "feathers",
      "application",
      "declarations",
      "declare",
      "module",
      "interface",
      "servicetypes",
      "class",
      "apikeystrategy",
      "extends",
      "app",
      "constructor",
      "super",
      "async",
      "authenticate",
      "const",
      "config",
      "get",
      "match",
      "includes",
      "throw",
      "new",
      "incorrect",
      "return",
      "true",
      "export",
      "function",
      "multiple",
      "calls",
      "strategies",
      "added",
      "src",
      "require",
      "name",
      "exports",
      "setup",
      "create",
      "hook",
      "called",
      "allow",
      "sets",
      "exist",
      "provider",
      "exists",
      "means",
      "external",
      "call",
      "also",
      "provide",
      "capability",
      "read",
      "query",
      "parameter",
      "filter",
      "passed",
      "find",
      "hookcontext",
      "nextfunction",
      "context",
      "headerfield",
      "headers",
      "headerfi",
      "content",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "authentication",
    "source": {
      "path": "cookbook/authentication/apiKey.md"
    },
    "tags": [
      "cookbook",
      "apikey",
      "header",
      "custom"
    ]
  },
  {
    "id": "v5-doc-042",
    "title": "Auth0 Integration",
    "content": "# Auth0\n\nTo enable OAuth logins with [Auth0](http://auth0.com), we need the following settings after creating an application:\n\n![Auth0 application](../assets/auth0-app.png)\n\nThis should be added in your configuration (usually `config/default.json`) as follows:\n\n```json\n\"authentication\": {\n  \"oauth\": {\n    \"redirect\": \"/\",\n    \"auth0\": {\n      \"key\": \"<Client ID>\",\n      \"secret\": \"<Client Secret>\",\n      \"subdomain\": \"<Domain without auth0.com\",\n      \"scope\": [\"openid\", \"profile\", \"email\"]\n    }\n  }\n}\n```\n\n> __Important:__ `subdomain` should be the \"Domain\" from the application settings __without__ the `auth0.com` part. So, in the screenshot above, the subdomain for `dev-6gqkmpt6.auth0.com` would be `dev-6gqkmpt6`. If the subdomain includes a region, it needs to be included as well so the subdomain for `dev-6gqkmpt6.us.auth0.com` would be `dev-6gqkmpt6.us`\n\n## Strategy\n\nTo use Auth0 in the chat application from the [Feathers guide](../../guides/) we have to do the same modifications as already shown [for the GitHub login in the authentication guide](../../guides/basics/authentication.md).\n\n\n\n<LanguageBlock global-id=\"ts\">\n\nIn `src/authentication.ts` like this:\n\n```ts\nimport { ServiceAddons, Params } from '@feathersjs/feathers';\nimport { AuthenticationService, JWTStrategy } from '@feathersjs/authentication';\nimport { LocalStrategy } from '@feathersjs/authentication-local';\nimport { oauth, OAuthStrategy, OAuthProfile } from '@feathersjs/authentication-oauth';\n\nimport { Application } from './declarations';\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    'authentication': AuthenticationService & ServiceAddons<any>;\n  }\n}\n\nclass Auth0Strategy extends OAuthStrategy {\n  async getEntityData(profile: OAuthProfile, existing: any, params: Params) {\n    const baseData = await super.getEntityData(profile, existing, params);\n\n    return {\n      ...baseData,\n      email: profile.email\n    };\n  }\n}\n\nexport default function(app: Application) {\n  const authentication = new AuthenticationService(app);\n\n  authentication.register('jwt', new JWTStrategy());\n  authentication.register('local', new LocalStrategy());\n  authentication.register('auth0', new Auth0Strategy());\n\n  app.use('/authentication', authentication);\n  app.configure(oauth());\n}\n```\n\n</LanguageBlock>\n\n<LanguageBlock global-id=\"js\">\n\nIn `src/authentication.js` like this:\n\n```js\nconst { AuthenticationService, JWTStrategy } = require('@feathersjs/authentication');\nconst { LocalStrategy } = require('@feathersjs/authentication-local');\nconst { expressOauth, OAuthStrategy } = require('@feathersjs/authentication-oauth');\n\nclass Auth0Strategy extends OAuthStrategy {\n  async getEntityData(profile) {\n    const baseData = await super.getEntityData(profile);\n\n    return {\n      ...baseData,\n      email: profile.email\n    };\n  }\n}\n\nmodule.exports = app => {\n  const authentication = new AuthenticationService(app);\n\n  authentication.register('jwt', new JWTStrategy());\n  authentication.register('local', new LocalStrategy());\n  authentication.register('auth0', new Auth0Strategy());\n\n  app.use('/authentication', authentication);\n  app.configure(expressOauth());\n};\n```\n\n</LanguageBlock>\n\n\n\nAdditionally, `auth0Id` needs to be included in the data in the users service class.",
    "version": "v5",
    "tokens": [
      "auth0",
      "integration",
      "enable",
      "oauth",
      "logins",
      "http",
      "com",
      "need",
      "following",
      "settings",
      "creating",
      "application",
      "assets",
      "app",
      "png",
      "added",
      "configuration",
      "usually",
      "config",
      "default",
      "json",
      "follows",
      "authentication",
      "redirect",
      "key",
      "client",
      "id",
      "secret",
      "subdomain",
      "domain",
      "without",
      "scope",
      "openid",
      "profile",
      "email",
      "important",
      "part",
      "screenshot",
      "dev",
      "6gqkmpt6",
      "if",
      "includes",
      "region",
      "needs",
      "included",
      "well",
      "us",
      "strategy",
      "use",
      "chat",
      "feathers",
      "guide",
      "guides",
      "modifications",
      "already",
      "shown",
      "github",
      "login",
      "basics",
      "md",
      "languageblock",
      "global",
      "ts",
      "src",
      "like",
      "import",
      "serviceaddons",
      "params",
      "feathersjs",
      "authenticationservice",
      "jwtstrategy",
      "localstrategy",
      "local",
      "oauthstrategy",
      "oauthprofile",
      "declarations",
      "declare",
      "module",
      "interface",
      "servicetypes",
      "class",
      "auth0strategy",
      "extends",
      "async",
      "getentitydata",
      "existing",
      "const",
      "basedata",
      "await",
      "super",
      "return",
      "export",
      "function",
      "new",
      "register",
      "jwt",
      "configure",
      "js",
      "require",
      "expressoauth",
      "exports",
      "additionally",
      "auth0id",
      "data",
      "users",
      "service"
    ],
    "category": "authentication",
    "source": {
      "path": "cookbook/authentication/auth0.md"
    },
    "tags": [
      "cookbook",
      "auth0",
      "oauth"
    ]
  },
  {
    "id": "v5-doc-043",
    "title": "Google OAuth",
    "content": "# Google\n\nTo enable Google login, add the app id, app secret and scope property to `config/default.json`:\n\n```js\n{\n  \"authentication\": {\n    \"oauth\": {\n      \"google\": {\n        \"key\": \"<App ID>\",\n        \"secret\": \"<App Secret>\",\n        \"scope\": [\"openid\"]\n      }\n    }\n  }\n}\n```\n\nAccording to the [documentation of Google](https://developers.google.com/identity/protocols/OpenIDConnect#scope-param):\n\"The scope value must begin with the string openid and then include profile or email or both.\".\n\n\nTo also request the email address, add the string \"email\" to the array of the 'scope' property:\n```js\n{\n  \"authentication\": {\n    \"oauth\": {\n      \"google\": {\n        \"key\": \"<App ID>\",\n        \"secret\": \"<App Secret>\",\n        \"scope\": [\"openid\", \"email\"],\n        \"nonce\": true\n      }\n    }\n  }\n}\n```\n\nThe property 'nonce', according to the documentation: \"A random value generated by your app that enables replay protection.\".\n\n## Application client and secret\n\nThe client id (App ID) and secret can be acquired by creating a [OAuth client ID](https://console.developers.google.com/apis/credentials):\n1. Click on 'OAuth client ID'\n![Creating OAuth client ID - step 1](https://bartduisters.com/img/feathers/oauth-client-id-1.png)\n2. Select 'web application', fill in the information and click 'Create'\n![Creating OAuth client ID - step 2](https://bartduisters.com/img/feathers/oauth-client-id-2.png)\n\n**Important**: Fill in the callback url, in a default Feathers setup it will be /oauth/google/callback.\n\n3. Replace `<App ID>` and `<App Secret>` with the id and secret of the created OAuth client ID application\n\n```js\n{\n  \"authentication\": {\n    \"oauth\": {\n      \"google\": {\n        \"key\": \"<client-id>.apps.googleusercontent.com\",\n        \"secret\": \"<client-secret>\",\n        \"scope\": [\"openid\", \"email\"],\n        \"nonce\": true\n      }\n    }\n  }\n}\n```\n\nNote: Use the generated credentials of the OAuth client ID.\n\nNote: `<client-id>` will be replaced by a string similar to **481298021138-hv27glb811ocr7pdon5lsg8hh5a6pgjv**.apps.googleusercontent.com.\n\nNote: `<client-secret>` will be replaced by a string similar to **XkWl0witdP4ogeNIgyOi-CeS**.\n\n## Using the data returned from the Google App through a custom OAuth Strategy\n\nIn `src/authentication.js`:\n\n```js\nconst axios = require('axios');\nconst { OAuthStrategy } = require('@feathersjs/authentication-oauth');\n\nclass GoogleStrategy extends OAuthStrategy {\n  async getEntityData(profile) {\n\n    // this will set 'googleId'\n    const baseData = await super.getEntityData(profile);\n\n    // this will grab the picture and email address of the Google profile\n    return {\n      ...baseData,\n      profilePicture: profile.picture,\n      email: profile.email\n    };\n  }\n}\n\nmodule.exports = app => {\n  const authentication = new AuthenticationService(app);\n\n  authentication.register('jwt', new JWTStrategy());\n  authentication.register('local', new LocalStrategy());\n  authentication.register('google', new GoogleStrategy());\n\n  app.use('/authentication', authentication);\n  app.configure(expressOauth());\n};\n```\n**Important**: googleId, profilePicture and email are properties that should exist on the database model!",
    "version": "v5",
    "tokens": [
      "google",
      "oauth",
      "enable",
      "login",
      "add",
      "app",
      "id",
      "secret",
      "scope",
      "property",
      "config",
      "default",
      "json",
      "js",
      "authentication",
      "key",
      "openid",
      "according",
      "documentation",
      "https",
      "developers",
      "com",
      "identity",
      "protocols",
      "openidconnect",
      "param",
      "value",
      "begin",
      "string",
      "include",
      "profile",
      "email",
      "also",
      "request",
      "address",
      "array",
      "nonce",
      "true",
      "random",
      "generated",
      "enables",
      "replay",
      "protection",
      "application",
      "client",
      "acquired",
      "creating",
      "console",
      "apis",
      "credentials",
      "click",
      "step",
      "bartduisters",
      "img",
      "feathers",
      "png",
      "select",
      "web",
      "fill",
      "information",
      "create",
      "important",
      "callback",
      "url",
      "setup",
      "replace",
      "created",
      "apps",
      "googleusercontent",
      "note",
      "use",
      "replaced",
      "similar",
      "481298021138",
      "hv27glb811ocr7pdon5lsg8hh5a6pgjv",
      "xkwl0witdp4ogenigyoi",
      "ces",
      "using",
      "data",
      "returned",
      "custom",
      "strategy",
      "src",
      "const",
      "axios",
      "require",
      "oauthstrategy",
      "feathersjs",
      "class",
      "googlestrategy",
      "extends",
      "async",
      "getentitydata",
      "set",
      "googleid",
      "basedata",
      "await",
      "super",
      "grab",
      "picture",
      "return",
      "profilepicture",
      "module",
      "exports",
      "new",
      "authenticationservice",
      "register",
      "jwt",
      "jwtstrategy",
      "local",
      "localstrategy",
      "configure",
      "expressoauth",
      "properties",
      "exist",
      "database",
      "model"
    ],
    "category": "authentication",
    "source": {
      "path": "cookbook/authentication/google.md"
    },
    "tags": [
      "cookbook",
      "google",
      "oauth",
      "social"
    ]
  },
  {
    "id": "v5-doc-044",
    "title": "Facebook OAuth",
    "content": "# Facebook\n\nFacebook login can be initialized like any other [OAuth provider](../../api/authentication/oauth.md) by adding the app id and secret to `config/default.json`:\n\n```js\n{\n  \"authentication\": {\n    \"oauth\": {\n      \"facebook\": {\n        \"key\": \"<App ID>\",\n        \"secret\": \"<App Secret>\"\n      }\n    }\n  }\n}\n```\n\nRequesting the email property requires adding additional `scope` to the oauth configuration:\n```js\n{\n  \"authentication\": {\n    \"oauth\": {\n      \"facebook\": {\n        \"key\": \"<App ID>\",\n        \"secret\": \"<App Secret>\",\n        \"scope\": [\"email, public_profile\"]\n      }\n    }\n  }\n}\n```\n\n## Application client and secret\n\nThe client id (App ID) and secret can be found in the Settings of the [Facebook app](https://developers.facebook.com/apps):\n\n![Facebook app settings](../assets/facebook-app.png)\n\n## Getting profile data\n\nThe standard OAuth strategy only returns the default profile fields (`id` and `name`). To get other fields, like the email or profile picture, the [getProfile](../../api/authentication/oauth.md#getprofile-data-params) method of the [OAuth strategy needs to be customized](../../api/authentication/oauth.md#customization) to call the Graph API profile endpoint `https://graph.facebook.com/me` with an HTTP request library like [Axios](https://developers.facebook.com/tools/explorer/) requesting the additional fields.\n\n> __Pro tip:__ Facebook API requests can be tested via the [Graph API explorer](https://developers.facebook.com/tools/explorer/).\n\nThe following example allows to log in with Facebook in the [chat application from the guide](../../guides/index.md):\n\n\n\n<LanguageBlock global-id=\"ts\">\n\n```ts\nimport { Params } from '@feathersjs/feathers';\nimport { AuthenticationService, JWTStrategy, AuthenticationRequest } from '@feathersjs/authentication';\nimport { LocalStrategy } from '@feathersjs/authentication-local';\nimport { expressOauth, OAuthStrategy, OAuthProfile } from '@feathersjs/authentication-oauth';\nimport axios from 'axios';\nimport { Application } from './declarations';\n\ndeclare module './declarations' {\n  interface ServiceTypes {\n    'authentication': AuthenticationService & ServiceAddons<any>;\n  }\n}\n\nclass FacebookStrategy extends OAuthStrategy {\n  async getProfile (authResult: AuthenticationRequest, _params: Params) {\n    // This is the OAuth access token that can be used\n    // for Facebook API requests as the Bearer token\n    const accessToken = authResult.access_token;\n\n    const { data } = await axios.get('https://graph.facebook.com/me', {\n      headers: {\n        authorization: `Bearer ${accessToken}`\n      },\n      params: {\n        // There are\n        fields: 'id,name,email'\n      }\n    });\n\n    return data;\n  }\n\n  async getEntityData(profile: OAuthProfile, existing: any, params: Params) {\n    // `profile` is the data returned by getProfile\n    const baseData = await super.getEntityData(profile, existing, params);\n\n    return {\n      ...baseData,\n      email: profile.email\n    };\n  }\n}\n\nexport default function(app: Application) {\n  const authentication = new AuthenticationService(app);\n\n  authentication.register('jwt', new JWTStrategy());\n  authentication.register('local', new LocalStrategy());\n  authentication.register('facebook', new FacebookStrategy());\n\n  app.use('/authentication', authentication);\n  app.configure(expressOauth());\n}\n```\n\n</LanguageBlock>\n\n<LanguageBlock global-id=\"js\">\n\nIn `src/authentication.js`:\n\n```js\nconst axios = require('axios');\nconst { AuthenticationService, JWTStrategy } = require('@feathersjs/authentication');\nconst { LocalStrategy } = require('@feathersjs/authentication-local');\nconst { expressOauth, OAuthStrategy } = require('@feathersjs/authentication-oauth');\n\nclass FacebookStrategy extends OAuthStrategy {\n  async getProfile (authResult) {\n    // This is the OAuth access token that can be used\n    // for Facebook API requests as the Bearer token\n    const accessToken = authResult.access_token;\n\n    const { data } = await axios.get('https://graph.fa\n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "facebook",
      "oauth",
      "login",
      "initialized",
      "like",
      "provider",
      "api",
      "authentication",
      "md",
      "adding",
      "app",
      "id",
      "secret",
      "config",
      "default",
      "json",
      "js",
      "key",
      "requesting",
      "email",
      "property",
      "requires",
      "additional",
      "scope",
      "configuration",
      "public",
      "profile",
      "application",
      "client",
      "found",
      "settings",
      "https",
      "developers",
      "com",
      "apps",
      "assets",
      "png",
      "getting",
      "data",
      "standard",
      "strategy",
      "returns",
      "fields",
      "name",
      "get",
      "picture",
      "getprofile",
      "params",
      "method",
      "needs",
      "customized",
      "customization",
      "call",
      "graph",
      "endpoint",
      "http",
      "request",
      "library",
      "axios",
      "tools",
      "explorer",
      "pro",
      "tip",
      "requests",
      "tested",
      "via",
      "following",
      "example",
      "allows",
      "log",
      "chat",
      "guide",
      "guides",
      "index",
      "languageblock",
      "global",
      "ts",
      "import",
      "feathersjs",
      "feathers",
      "authenticationservice",
      "jwtstrategy",
      "authenticationrequest",
      "localstrategy",
      "local",
      "expressoauth",
      "oauthstrategy",
      "oauthprofile",
      "declarations",
      "declare",
      "module",
      "interface",
      "servicetypes",
      "serviceaddons",
      "class",
      "facebookstrategy",
      "extends",
      "async",
      "authresult",
      "access",
      "token",
      "used",
      "bearer",
      "const",
      "accesstoken",
      "await",
      "headers",
      "authorization",
      "return",
      "getentitydata",
      "existing",
      "returned",
      "basedata",
      "super",
      "export",
      "function",
      "new",
      "register",
      "jwt",
      "use",
      "configure",
      "src",
      "require",
      "fa",
      "content",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "authentication",
    "source": {
      "path": "cookbook/authentication/facebook.md"
    },
    "tags": [
      "cookbook",
      "facebook",
      "oauth",
      "social"
    ]
  },
  {
    "id": "v5-doc-045",
    "title": "Firebase Authentication",
    "content": "# Firebase\n\n[Firebase](https://firebase.google.com/docs/auth) requires a custom [OAuth Authentication Strategy](../../api/authentication/oauth.html#oauthstrategy). This is because one is not provided to us, by the default [Grant](https://github.com/simov/grant) configuration Feathers uses for [OAuth](https://docs.feathersjs.com/api/authentication/oauth.html#oauth).\n\nSince Firebase does not provide a UI for us to redirect to, we use flow #2 outlined in [OAuth Flow](../../api/authentication/oauth.html#flow).\n\n\n## Authentation Setup\n\nUpdate `config/default.json`:\n\n```json\n{\n  \"authentication\": {\n    \"oauth\": {}\n  },\n  \"firebase\": {\n    \"type\": \"THIS SHOULD BE YOUR SERVICE ACCOUNT\",\n    \"project_id\": \"GENERATED UNDER FIREBASE CONSOLE\",\n    \"...\": \"...\"\n  }\n}\n\n```\n> Note: Since Firebase can be used for more than just authentication, we'll store our service account in the root of our config. Otherwise, if preferred, you can store under `authentication.oauth`.\n\n## Authentication Strategy\n\nCreate a file under `src/firebase.js`:\n\n```js\nconst firebase = require('firebase-admin');\nconst { OAuthStrategy } = require('@feathersjs/authentication-oauth');\nconst { NotAuthenticated } = require('@feathersjs/errors');\n\nconst logger = require('./logger');\n\nfunction initialize(app){\n  const firebaseConfig = app.get('firebase');\n\n  // Initialize app\n  try {\n    firebase.initializeApp({\n      credential: firebase.credential.cert(firebaseConfig)\n    });\n  } catch (e) {\n    console.log('erorr initializing firebase', e);\n  }\n}\n\nclass FirebaseStrategy extends OAuthStrategy {\n\n  async authenticate(authentication, params){\n    logger.debug('firebase:strategy:authenticate');\n    return super.authenticate(authentication, params);\n  }\n\n  async getProfile(data, _params){\n    const firebase = require('firebase-admin');\n    let user;\n\n    try {\n      user = await firebase.auth().verifyIdToken(data.access_token);\n    } catch(e){\n      logger.error(e);\n      throw new NotAuthenticated();\n    }\n\n    logger.debug(`firebase:strategy:getProfile:successful ${user.user_id}`);\n\n    return {\n      email: user.email,\n      id: user.user_id\n    };\n  }\n\n  async getEntityData(profile) {\n    const baseData = await super.getEntityData(profile);\n\n    return {\n      ...baseData,\n      email: profile.email\n    };\n  }\n}\n\nmodule.exports = { initialize, FirebaseStrategy };\n```\n\nNow we can edit `src/authentication.js`\n\n```js\nconst { AuthenticationService, JWTStrategy } = require('@feathersjs/authentication');\nconst { expressOauth } = require('@feathersjs/authentication-oauth');\n\nconst { FirebaseStrategy } = require('./firebase');\n\nmodule.exports = app => {\n  const authentication = new AuthenticationService(app);\n\n  authentication.register('firebase', new FirebaseStrategy());\n\n  app.use('/authentication', authentication);\n  app.configure(expressOauth());\n};\n```\n\n## Building frontend\n\nTo save time, you can leverage the pre-built UI provided by [Firebase UI](https://firebase.google.com/docs/auth/web/firebaseui).\n\n### Create auth page\n\nFirst, create a `public/firebase_auth.html` file that initializes everything we'll need for our different auth components.\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Firebase Authentication Example</title>\n  <!-- The core Firebase JS SDK is always required and must be listed first -->\n  <script src=\"https://www.gstatic.com/firebasejs/7.21.0/firebase-app.js\"></script>\n\n  <!-- TODO: Add SDKs for Firebase products that you want to use\n       https://firebase.google.com/docs/web/setup#available-libraries -->\n  <script src=\"https://www.gstatic.com/firebasejs/7.21.0/firebase-auth.js\"></script>\n\n  <!-- Firebase UI -->\n  <script src=\"https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js\"></script>\n  <link type=\"text/css\" rel=\"stylesheet\" href=\"https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.css\" />\n\n</head>\n<body>\n  <!-- The surrou\n\n[... content truncated for knowledge base ...]",
    "version": "v5",
    "tokens": [
      "firebase",
      "authentication",
      "https",
      "google",
      "com",
      "docs",
      "auth",
      "requires",
      "custom",
      "oauth",
      "strategy",
      "api",
      "html",
      "oauthstrategy",
      "one",
      "provided",
      "us",
      "default",
      "grant",
      "github",
      "simov",
      "configuration",
      "feathers",
      "uses",
      "feathersjs",
      "since",
      "provide",
      "ui",
      "redirect",
      "use",
      "flow",
      "outlined",
      "authentation",
      "setup",
      "update",
      "config",
      "json",
      "type",
      "service",
      "account",
      "project",
      "id",
      "generated",
      "console",
      "note",
      "used",
      "ll",
      "store",
      "root",
      "otherwise",
      "if",
      "preferred",
      "create",
      "file",
      "src",
      "js",
      "const",
      "require",
      "admin",
      "notauthenticated",
      "errors",
      "logger",
      "function",
      "initialize",
      "app",
      "firebaseconfig",
      "get",
      "try",
      "initializeapp",
      "credential",
      "cert",
      "catch",
      "log",
      "erorr",
      "initializing",
      "class",
      "firebasestrategy",
      "extends",
      "async",
      "authenticate",
      "params",
      "debug",
      "return",
      "super",
      "getprofile",
      "data",
      "let",
      "user",
      "await",
      "verifyidtoken",
      "access",
      "token",
      "error",
      "throw",
      "new",
      "successful",
      "email",
      "getentitydata",
      "profile",
      "basedata",
      "module",
      "exports",
      "now",
      "edit",
      "authenticationservice",
      "jwtstrategy",
      "expressoauth",
      "register",
      "configure",
      "building",
      "frontend",
      "save",
      "time",
      "leverage",
      "pre",
      "built",
      "web",
      "firebaseui",
      "page",
      "first",
      "public",
      "initializes",
      "everything",
      "need",
      "different",
      "components",
      "doctype",
      "lang",
      "en",
      "head",
      "meta",
      "charset",
      "utf",
      "name",
      "viewport",
      "content",
      "width",
      "device",
      "initial",
      "scale",
      "title",
      "example",
      "core",
      "sdk",
      "always",
      "required",
      "listed",
      "script",
      "www",
      "gstatic",
      "firebasejs",
      "21",
      "todo",
      "add",
      "sdks",
      "products",
      "want",
      "available",
      "libraries",
      "link",
      "text",
      "css",
      "rel",
      "stylesheet",
      "href",
      "body",
      "surrou",
      "truncated",
      "knowledge",
      "base"
    ],
    "category": "authentication",
    "source": {
      "path": "cookbook/authentication/firebase.md"
    },
    "tags": [
      "cookbook",
      "firebase",
      "custom"
    ]
  },
  {
    "id": "v5-doc-046",
    "title": "Revoking JWTs",
    "content": "# Revoking JWTs\n\nBy default a valid JWT can be used for as long as it is valid. To do a normal logout the client just \"forgets\" their JWT (usually by removing it from localStorage).\n\nTo add the ability to revoke an access token so that it can be no longer used even if it is still valid [the authentication service](../../api/authentication/service.md) can be customized as follows.\n\n## Basic example\n\nThe following example shows the basic flow of how a JWT can be revoked by storing it in a plain object. In a normal application you would use something like the [Redis storage shown below](#using-redis).\n\n```js\nconst { AuthenticationService } = require('@feathersjs/authentication');\nconst { NotAuthenticated } = require('@feathersjs/errors');\n\nconst revokedTokens = {};\n\nclass RevokableAuthService extends AuthenticationService {\n  async revokeAccessToken (accessToken) {\n    // First make sure the access token is valid\n    const verified = await this.verifyAccessToken(accessToken);\n\n    revokedTokens[accessToken] = true;\n\n    return verified;\n  }\n\n  async verifyAccessToken(accessToken) {\n    // First check if the token has been revoked\n    if (revokedTokens[accessToken]) {\n      throw new NotAuthenticated('Token revoked');\n    }\n\n    return super.verifyAccessToken(accessToken);\n  }\n\n  async remove (id, params) {\n    const authResult = await super.remove(id, params);\n    const { accessToken } = authResult;\n\n    if (accessToken) {\n      // If there is an access token, revoke it\n      await this.revokeAccessToken(accessToken);\n    }\n\n    return authResult;\n  }\n}\n\napp.use('/authentication', new RevokableAuthService(app));\n```\n\n## Using Redis\n\n[Redis](https://redis.io/) is a great storage mechanism for revoked JWTs because it allows to remove keys after a certain time. A revoked JWT does not have to be stored forever and can be removed from storage after it has expired since it will no longer be valid anyway. The flow is the same as shown above but using the NodeJS Redis adapter instead:\n\n```\nnpm install redis\n```\n\n```js\nconst redis = require('redis');\n\nconst { AuthenticationService } = require('@feathersjs/authentication');\nconst { NotAuthenticated } = require('@feathersjs/errors');\n\nclass RedisAuthService extends AuthenticationService {\n  constructor (app, configKey) {\n    super(app, configKey);\n\n    const client = redis.createClient();\n\n    this.redis = {\n      client,\n      get: client.get.bind(client),\n      set: client.set.bind(client),\n      exists: client.exists.bind(client),\n      expireat: client.exists.bind(client)\n    }\n\n    (async () => {\n      await this.redis.client.connect();\n    })()\n  }\n\n  async revokeAccessToken (accessToken) {\n    // First make sure the access token is valid\n    const verified = await this.verifyAccessToken(accessToken);\n    // Calculate the remaining valid time for the token (in seconds)\n    const expiry = verified.exp - Math.floor(Date.now() / 1000);\n\n    // Add the revoked token to Redis and set expiration\n    await this.redis.set(accessToken, 1, { EX: expiry });\n\n    return verified;\n  }\n\n  async verifyAccessToken(accessToken) {\n    if (await this.redis.exists(accessToken)) {\n      throw new NotAuthenticated('Token revoked');\n    }\n\n    return super.verifyAccessToken(accessToken);\n  }\n\n  async remove (id, params) {\n    const authResult = await super.remove(id, params);\n    const { accessToken } = authResult;\n\n    if (accessToken) {\n      // If there is an access token, revoke it\n      await this.revokeAccessToken(accessToken);\n    }\n\n    return authResult;\n  }\n}\n\napp.use('/authentication', new RedisAuthService(app));\n```",
    "version": "v5",
    "tokens": [
      "revoking",
      "jwts",
      "default",
      "valid",
      "jwt",
      "used",
      "long",
      "normal",
      "logout",
      "client",
      "forgets",
      "usually",
      "removing",
      "localstorage",
      "add",
      "ability",
      "revoke",
      "access",
      "token",
      "longer",
      "even",
      "if",
      "still",
      "authentication",
      "service",
      "api",
      "md",
      "customized",
      "follows",
      "basic",
      "example",
      "following",
      "shows",
      "flow",
      "revoked",
      "storing",
      "plain",
      "object",
      "application",
      "use",
      "something",
      "like",
      "redis",
      "storage",
      "shown",
      "using",
      "js",
      "const",
      "authenticationservice",
      "require",
      "feathersjs",
      "notauthenticated",
      "errors",
      "revokedtokens",
      "class",
      "revokableauthservice",
      "extends",
      "async",
      "revokeaccesstoken",
      "accesstoken",
      "first",
      "make",
      "sure",
      "verified",
      "await",
      "verifyaccesstoken",
      "true",
      "return",
      "check",
      "throw",
      "new",
      "super",
      "remove",
      "id",
      "params",
      "authresult",
      "app",
      "https",
      "io",
      "great",
      "mechanism",
      "allows",
      "keys",
      "certain",
      "time",
      "stored",
      "forever",
      "removed",
      "expired",
      "since",
      "anyway",
      "nodejs",
      "adapter",
      "instead",
      "npm",
      "install",
      "redisauthservice",
      "constructor",
      "configkey",
      "createclient",
      "get",
      "bind",
      "set",
      "exists",
      "expireat",
      "connect",
      "calculate",
      "remaining",
      "seconds",
      "expiry",
      "exp",
      "math",
      "floor",
      "date",
      "now",
      "1000",
      "expiration",
      "ex"
    ],
    "category": "authentication",
    "source": {
      "path": "cookbook/authentication/revoke-jwt.md"
    },
    "tags": [
      "cookbook",
      "jwt",
      "revoke",
      "blacklist"
    ]
  },
  {
    "id": "v5-doc-047",
    "title": "Stateless Authentication",
    "content": "# Stateless JWT\n\nBy default, an authentication token is associated to an entity (usually a user). It is also possible to issue tokens that are stateless and not tied to an entity lookup. This can be useful when all the information necessary can be contained in the token payload. The drawback is that the token information can not be changed and will always be valid until the token expires so it is e.g. not possible to disable a user or change their permissions before the token expires.\n\n## Configuration\n\nStateless tokens can be issued by setting the `entity` option in the [JWT strategy authentication configuration](../../api/authentication/jwt.md#configuration) to `null` (in which case `service` option also won't be used):\n\n```json\n{\n  \"authentication\": {\n    \"secret\": \"CHANGE_ME\",\n    \"entity\": null,\n    \"authStrategies\": [ \"jwt\", \"local\" ],\n    \"jwtOptions\": {\n      \"header\": { \"typ\": \"access\" },\n      \"audience\": \"https://yourdomain.com\",\n      \"issuer\": \"feathers\",\n      \"algorithm\": \"HS256\",\n      \"expiresIn\": \"1d\"\n    }\n  }\n}\n```\n\n> __Note:__ When still using other built-in strategies (like the [local strategy](../../api/authentication/local.md)) with an entity, the option can be set for each strategy (e.g. `{ \"authentication\": { \"local\": { \"entity\": \"user\" } } }`).\n\n## Customizing the payload\n\nIn order for the token to contain information, the `getPayload` method needs to be customize by [extending the authentication service](../../api/authentication/service.md#customization):\n\n```js\nconst { AuthenticationService } = require('@feathersjs/authentication');\n\nclass MyAuthService extends AuthenticationService {\n  async getPayload(authResult, params) {\n    // Call original `getPayload` first\n    const payload = await super.getPayload(authResult, params);\n    const { user } = authResult;\n\n    if (user && user.permissions) {\n      payload.permissions = user.permissions;\n    }\n\n    return payload;\n  }\n}\n\napp.use('/authentication', new MyAuthService(app));\n```",
    "version": "v5",
    "tokens": [
      "stateless",
      "authentication",
      "jwt",
      "default",
      "token",
      "associated",
      "entity",
      "usually",
      "user",
      "also",
      "possible",
      "issue",
      "tokens",
      "tied",
      "lookup",
      "useful",
      "information",
      "necessary",
      "contained",
      "payload",
      "drawback",
      "changed",
      "always",
      "valid",
      "expires",
      "disable",
      "change",
      "permissions",
      "configuration",
      "issued",
      "setting",
      "option",
      "strategy",
      "api",
      "md",
      "null",
      "case",
      "service",
      "won",
      "used",
      "json",
      "secret",
      "authstrategies",
      "local",
      "jwtoptions",
      "header",
      "typ",
      "access",
      "audience",
      "https",
      "yourdomain",
      "com",
      "issuer",
      "feathers",
      "algorithm",
      "hs256",
      "expiresin",
      "1d",
      "note",
      "still",
      "using",
      "built",
      "strategies",
      "like",
      "set",
      "customizing",
      "order",
      "contain",
      "getpayload",
      "method",
      "needs",
      "customize",
      "extending",
      "customization",
      "js",
      "const",
      "authenticationservice",
      "require",
      "feathersjs",
      "class",
      "myauthservice",
      "extends",
      "async",
      "authresult",
      "params",
      "call",
      "original",
      "first",
      "await",
      "super",
      "if",
      "return",
      "app",
      "use",
      "new"
    ],
    "category": "authentication",
    "source": {
      "path": "cookbook/authentication/stateless.md"
    },
    "tags": [
      "cookbook",
      "stateless",
      "jwt",
      "entity"
    ]
  }
]
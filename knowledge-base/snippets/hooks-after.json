[
  {
    "id": "snp-006",
    "type": "after",
    "useCase": "Remove sensitive fields from response",
    "code": "app.service('users').hooks({\n  after: {\n    all: [\n      async (context: HookContext) => {\n        const removePassword = (user: any) => {\n          const { password, ...rest } = user\n          return rest\n        }\n        if (Array.isArray(context.result)) {\n          context.result = context.result.map(removePassword)\n        } else if (context.result.data) {\n          context.result.data = context.result.data.map(removePassword)\n        } else {\n          context.result = removePassword(context.result)\n        }\n      }\n    ]\n  }\n})",
    "explanation": "Removes password field from user data in responses. Handles both single and paginated results. Prefer resolveExternal for this in v5.",
    "version": "v5",
    "language": "typescript",
    "tags": [
      "security",
      "password",
      "sanitize"
    ]
  },
  {
    "id": "snp-007",
    "type": "after",
    "useCase": "Populate associated data",
    "code": "import { resolve, virtual } from '@feathersjs/schema'\n\nexport const messageResultResolver = resolve<Message, HookContext>({\n  user: virtual(async (message, context) => {\n    return context.app.service('users').get(message.userId)\n  })\n})\n\n// Register as around hook\napp.service('messages').hooks({\n  around: {\n    all: [resolveResult(messageResultResolver)]\n  }\n})",
    "explanation": "Populates the user field on message results using a virtual resolver. This is the v5 recommended pattern for associations.",
    "version": "v5",
    "language": "typescript",
    "tags": [
      "resolver",
      "populate",
      "association",
      "virtual"
    ]
  },
  {
    "id": "snp-008",
    "type": "after",
    "useCase": "Log service method calls",
    "code": "app.hooks({\n  after: {\n    all: [\n      async (context: HookContext) => {\n        console.log(`${context.method} on ${context.path} completed`)\n      }\n    ]\n  }\n})",
    "explanation": "Application-level hook that logs all successful service method calls.",
    "version": "v5",
    "language": "typescript",
    "tags": [
      "logging",
      "debug",
      "application"
    ]
  },
  {
    "id": "snp-020",
    "type": "after",
    "useCase": "Add computed field to result",
    "code": "app.service('orders').hooks({\n  after: {\n    all: [\n      async (context: HookContext) => {\n        const addTotal = (order: any) => ({\n          ...order,\n          total: order.items.reduce((sum: number, item: any) => sum + item.price * item.quantity, 0)\n        })\n        if (Array.isArray(context.result?.data)) {\n          context.result.data = context.result.data.map(addTotal)\n        } else if (context.result) {\n          context.result = addTotal(context.result)\n        }\n      }\n    ]\n  }\n})",
    "explanation": "Adds a computed total field to order results based on line items.",
    "version": "v5",
    "language": "typescript",
    "tags": [
      "computed",
      "transform",
      "after"
    ]
  },
  {
    "id": "snp-021",
    "type": "after",
    "useCase": "Send notification after create",
    "code": "app.service('messages').hooks({\n  after: {\n    create: [\n      async (context: HookContext) => {\n        await context.app.service('notifications').create({\n          type: 'new-message',\n          userId: context.result.userId,\n          message: `New message: ${context.result.text.substring(0, 50)}`\n        })\n      }\n    ]\n  }\n})",
    "explanation": "Sends a notification to the relevant user after a new message is created.",
    "version": "v5",
    "language": "typescript",
    "tags": [
      "notification",
      "create",
      "after"
    ]
  },
  {
    "id": "snp-022",
    "type": "after",
    "useCase": "Cache results after find",
    "code": "const cache = new Map<string, { data: any; expires: number }>()\n\napp.service('config').hooks({\n  after: {\n    find: [\n      async (context: HookContext) => {\n        const key = JSON.stringify(context.params.query)\n        cache.set(key, { data: context.result, expires: Date.now() + 60000 })\n      }\n    ]\n  },\n  before: {\n    find: [\n      async (context: HookContext) => {\n        const key = JSON.stringify(context.params.query)\n        const cached = cache.get(key)\n        if (cached && cached.expires > Date.now()) {\n          context.result = cached.data\n        }\n      }\n    ]\n  }\n})",
    "explanation": "Simple in-memory cache for find results with 60-second TTL.",
    "version": "v5",
    "language": "typescript",
    "tags": [
      "cache",
      "performance",
      "find"
    ]
  }
]